<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è¯äº‹ä¸è¡€æ¶²ç®¡ç† - åŒ»ç–—è´¨é‡å®‰å…¨ç›‘æµ‹ç³»ç»Ÿ</title>
    <link rel="stylesheet" href="../css/style.css">
    <link rel="stylesheet" href="../css/medical-quality-safety.css">
    <script src="../js/common.js"></script>
    <script src="../js/navigation-loader.js"></script>
    <script src="../js/medical-quality-components.js"></script>
    <script src="../js/medical-charts.js"></script>
    <script src="../js/medical-data-simulator.js"></script>
    <style>
        .pharmacy-blood-container {
            padding: 20px;
            background: #f8f9fa;
            min-height: 100vh;
        }

        .page-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            border-radius: 12px;
            margin-bottom: 20px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }

        .page-header h1 {
            margin: 0;
            font-size: 2.2rem;
            font-weight: 600;
        }

        .page-header .subtitle {
            margin: 8px 0 0 0;
            opacity: 0.9;
            font-size: 1.1rem;
        }

        .breadcrumb {
            margin-bottom: 20px;
        }

        .breadcrumb-list {
            display: flex;
            list-style: none;
            padding: 0;
            margin: 0;
            background: white;
            padding: 12px 20px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }

        .breadcrumb-item {
            color: #6c757d;
        }

        .breadcrumb-item:last-child {
            color: #495057;
            font-weight: 500;
        }

        .breadcrumb-separator {
            margin: 0 10px;
            color: #dee2e6;
        }

        /* å®æ—¶ç›‘æ§é¢æ¿ */
        .real-time-panel {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 12px rgba(0,0,0,0.08);
        }

        .real-time-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e9ecef;
        }

        .real-time-title {
            font-size: 1.3rem;
            font-weight: 600;
            color: #2c3e50;
        }

        .last-update {
            color: #6c757d;
            font-size: 0.9rem;
        }

        .real-time-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .real-time-item {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            border-left: 4px solid #007bff;
        }

        .real-time-item.medication {
            border-left-color: #28a745;
        }

        .real-time-item.blood {
            border-left-color: #dc3545;
        }

        .real-time-item.adverse {
            border-left-color: #ffc107;
        }

        .real-time-item.inventory {
            border-left-color: #17a2b8;
        }

        .real-time-value {
            font-size: 1.8rem;
            font-weight: 700;
            color: #2c3e50;
            margin-bottom: 5px;
        }

        .real-time-label {
            font-size: 0.9rem;
            color: #6c757d;
        }

        /* ç»Ÿè®¡å¡ç‰‡ */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.08);
            transition: all 0.3s ease;
            cursor: pointer;
            border-left: 5px solid #007bff;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }

        .stat-card.medication {
            border-left-color: #28a745;
        }

        .stat-card.blood {
            border-left-color: #dc3545;
        }

        .stat-card.adverse {
            border-left-color: #ffc107;
        }

        .stat-card.antibiotic {
            border-left-color: #6f42c1;
        }

        .stat-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .stat-title {
            font-size: 1rem;
            color: #6c757d;
            font-weight: 500;
        }

        .stat-icon {
            font-size: 2rem;
            opacity: 0.8;
        }

        .stat-value {
            font-size: 2.5rem;
            font-weight: 700;
            color: #2c3e50;
            margin-bottom: 10px;
        }

        .stat-change {
            font-size: 0.9rem;
            font-weight: 500;
        }

        .stat-change.positive {
            color: #28a745;
        }

        .stat-change.negative {
            color: #dc3545;
        }

        .stat-change.stable {
            color: #6c757d;
        }

        /* ä¸»è¦å†…å®¹ç½‘æ ¼ */
        .content-grid {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }

        .main-chart-area {
            background: white;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.08);
        }

        .chart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e9ecef;
        }

        .chart-title {
            font-size: 1.4rem;
            font-weight: 600;
            color: #2c3e50;
            margin: 0;
        }

        .chart-controls {
            display: flex;
            gap: 10px;
        }

        .chart-control-btn {
            padding: 8px 16px;
            border: 2px solid #e9ecef;
            background: white;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9rem;
            font-weight: 500;
        }

        .chart-control-btn:hover {
            border-color: #007bff;
            color: #007bff;
        }

        .chart-control-btn.active {
            background: #007bff;
            color: white;
            border-color: #007bff;
        }

        .chart-wrapper {
            height: 400px;
            width: 100%;
        }

        /* ä¾§è¾¹æ  */
        .sidebar-content {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .sidebar-panel {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.08);
        }

        .panel-header {
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e9ecef;
        }

        .panel-title {
            font-size: 1.2rem;
            font-weight: 600;
            color: #2c3e50;
            margin: 0 0 5px 0;
        }

        .panel-subtitle {
            color: #6c757d;
            font-size: 0.9rem;
            margin: 0;
        }

        /* æŒ‡æ ‡åˆ—è¡¨ */
        .indicator-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .indicator-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            background: #f8f9fa;
            border-radius: 8px;
            transition: all 0.3s ease;
        }

        .indicator-item:hover {
            background: #e9ecef;
            transform: translateX(5px);
        }

        .indicator-name {
            font-weight: 500;
            color: #495057;
        }

        .indicator-value {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .indicator-number {
            font-weight: 700;
            font-size: 1.1rem;
        }

        .indicator-number.good {
            color: #28a745;
        }

        .indicator-number.warning {
            color: #ffc107;
        }

        .indicator-number.danger {
            color: #dc3545;
        }

        .indicator-trend {
            font-size: 0.8rem;
            font-weight: 600;
        }

        .indicator-trend.up {
            color: #28a745;
        }

        .indicator-trend.down {
            color: #dc3545;
        }

        .indicator-trend.stable {
            color: #6c757d;
        }

        /* è¯ç‰©ç›¸äº’ä½œç”¨ç›‘æ§ */
        .drug-interaction-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 10px;
        }

        .interaction-item {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 6px;
            padding: 10px;
            text-align: center;
            font-size: 0.8rem;
        }

        .interaction-item.high-risk {
            background: #f8d7da;
            border-color: #f5c6cb;
        }

        .interaction-item.medium-risk {
            background: #fff3cd;
            border-color: #ffeaa7;
        }

        .interaction-item.low-risk {
            background: #d1ecf1;
            border-color: #bee5eb;
        }

        /* è¡€æ¶²åˆ¶å“è¿½æº¯ */
        .blood-tracking {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .tracking-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 6px;
            border-left: 3px solid #dc3545;
        }

        .tracking-info {
            display: flex;
            flex-direction: column;
        }

        .tracking-id {
            font-weight: 600;
            color: #495057;
            font-size: 0.9rem;
        }

        .tracking-status {
            font-size: 0.8rem;
            color: #6c757d;
        }

        .tracking-badge {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.7rem;
            font-weight: 600;
        }

        .tracking-badge.in-use {
            background: #d4edda;
            color: #155724;
        }

        .tracking-badge.expired {
            background: #f8d7da;
            color: #721c24;
        }

        .tracking-badge.available {
            background: #d1ecf1;
            color: #0c5460;
        }

        /* æ•°æ®è¡¨æ ¼ */
        .data-table {
            background: white;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.08);
        }

        .table-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e9ecef;
        }

        .table-header h3 {
            margin: 0;
            font-size: 1.3rem;
            font-weight: 600;
            color: #2c3e50;
        }

        .table-controls {
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .search-box {
            position: relative;
        }

        .search-box input {
            padding: 8px 35px 8px 12px;
            border: 2px solid #e9ecef;
            border-radius: 20px;
            font-size: 0.9rem;
            width: 250px;
            transition: border-color 0.3s ease;
        }

        .search-box input:focus {
            outline: none;
            border-color: #007bff;
        }

        .search-icon {
            position: absolute;
            right: 12px;
            top: 50%;
            transform: translateY(-50%);
            color: #6c757d;
        }

        .filter-select {
            padding: 8px 12px;
            border: 2px solid #e9ecef;
            border-radius: 6px;
            font-size: 0.9rem;
            background: white;
            cursor: pointer;
        }

        .table-wrapper {
            overflow-x: auto;
        }

        .quality-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.9rem;
        }

        .quality-table th {
            background: #f8f9fa;
            padding: 15px 12px;
            text-align: left;
            font-weight: 600;
            color: #495057;
            border-bottom: 2px solid #dee2e6;
        }

        .quality-table td {
            padding: 12px;
            border-bottom: 1px solid #dee2e6;
            color: #495057;
        }

        .quality-table tbody tr {
            transition: background-color 0.3s ease;
            cursor: pointer;
        }

        .quality-table tbody tr:hover {
            background: #f8f9fa;
        }

        .quality-table tbody tr.selected {
            background: #e3f2fd;
        }

        .status-badge {
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .status-badge.excellent {
            background: #d4edda;
            color: #155724;
        }

        .status-badge.good {
            background: #d1ecf1;
            color: #0c5460;
        }

        .status-badge.warning {
            background: #fff3cd;
            color: #856404;
        }

        .status-badge.danger {
            background: #f8d7da;
            color: #721c24;
        }

        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 1200px) {
            .content-grid {
                grid-template-columns: 1fr;
            }
            
            .stats-grid {
                grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            }
        }

        @media (max-width: 768px) {
            .pharmacy-blood-container {
                padding: 10px;
            }
            
            .page-header {
                padding: 20px;
            }
            
            .page-header h1 {
                font-size: 1.8rem;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .real-time-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .table-controls {
                flex-direction: column;
                align-items: stretch;
                gap: 10px;
            }
            
            .search-box input {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <!-- ç»Ÿä¸€å¯¼èˆªç»„ä»¶ -->
    <div id="navigation-container"></div>
    
    <div class="container">
        <div class="main-content">
            <div class="content-wrapper">
                <main class="content">
                    <div class="pharmacy-blood-container">
                        <!-- é¡µé¢æ ‡é¢˜ -->
                        <div class="page-header">
                            <h1>è¯äº‹ä¸è¡€æ¶²ç®¡ç†</h1>
                            <div class="subtitle">Pharmacy and Blood Management</div>
                        </div>

                        <!-- é¢åŒ…å±‘å¯¼èˆª -->
                        <div class="breadcrumb">
                            <ul class="breadcrumb-list">
                                <li class="breadcrumb-item">é¦–é¡µ</li>
                                <li class="breadcrumb-separator">/</li>
                                <li class="breadcrumb-item">åŒ»ç–—è´¨é‡å®‰å…¨ç›‘æµ‹</li>
                                <li class="breadcrumb-separator">/</li>
                                <li class="breadcrumb-item">è¯äº‹ä¸è¡€æ¶²ç®¡ç†</li>
                            </ul>
                        </div>

                        <!-- å®æ—¶ç›‘æ§é¢æ¿ -->
                        <div class="real-time-panel">
                            <div class="real-time-header">
                                <div class="real-time-title">å®æ—¶ç›‘æ§æ•°æ®</div>
                                <div class="last-update">æœ€åæ›´æ–°: <span id="lastUpdate">--:--:--</span></div>
                            </div>
                            <div class="real-time-grid">
                                <div class="real-time-item medication">
                                    <div class="real-time-value" id="activePrescriptions">--</div>
                                    <div class="real-time-label">æ´»è·ƒå¤„æ–¹æ•°</div>
                                </div>
                                <div class="real-time-item blood">
                                    <div class="real-time-value" id="bloodUnitsAvailable">--</div>
                                    <div class="real-time-label">è¡€æ¶²åº“å­˜å•ä½</div>
                                </div>
                                <div class="real-time-item adverse">
                                    <div class="real-time-value" id="adverseEvents">--</div>
                                    <div class="real-time-label">ä»Šæ—¥ä¸è‰¯äº‹ä»¶</div>
                                </div>
                                <div class="real-time-item inventory">
                                    <div class="real-time-value" id="inventoryTurnover">--</div>
                                    <div class="real-time-label">åº“å­˜å‘¨è½¬ç‡</div>
                                </div>
                            </div>
                        </div>

                        <!-- ç»Ÿè®¡å¡ç‰‡åŒºåŸŸ -->
                        <div class="stats-grid" id="statsGrid">
                            <!-- ç»Ÿè®¡å¡ç‰‡å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                        </div>

                        <!-- ä¸»è¦å†…å®¹åŒºåŸŸ -->
                        <div class="content-grid">
                            <!-- ä¸»è¦å›¾è¡¨åŒºåŸŸ -->
                            <div class="main-chart-area">
                                <div class="chart-header">
                                    <h3 class="chart-title">è¯äº‹ä¸è¡€æ¶²ç®¡ç†è¶‹åŠ¿åˆ†æ</h3>
                                    <div class="chart-controls">
                                        <button class="chart-control-btn active" data-chart="trend">è¶‹åŠ¿åˆ†æ</button>
                                        <button class="chart-control-btn" data-chart="safety">ç”¨è¯å®‰å…¨</button>
                                        <button class="chart-control-btn" data-chart="blood">è¡€æ¶²ç®¡ç†</button>
                                    </div>
                                </div>
                                <div class="chart-wrapper">
                                    <div id="mainChart" style="width: 100%; height: 100%;"></div>
                                </div>
                            </div>

                            <!-- ä¾§è¾¹æ å†…å®¹ -->
                            <div class="sidebar-content">
                                <!-- å…³é”®æŒ‡æ ‡ -->
                                <div class="sidebar-panel">
                                    <div class="panel-header">
                                        <h3 class="panel-title">å…³é”®æŒ‡æ ‡ç›‘æ§</h3>
                                        <p class="panel-subtitle">å®æ—¶è¯äº‹ä¸è¡€æ¶²ç®¡ç†æŒ‡æ ‡</p>
                                    </div>
                                    <div class="indicator-list" id="indicatorList">
                                        <!-- æŒ‡æ ‡åˆ—è¡¨å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                                    </div>
                                </div>

                                <!-- è¯ç‰©ç›¸äº’ä½œç”¨ç›‘æ§ -->
                                <div class="sidebar-panel">
                                    <div class="panel-header">
                                        <h3 class="panel-title">è¯ç‰©ç›¸äº’ä½œç”¨</h3>
                                        <p class="panel-subtitle">å½“å‰æ´»è·ƒçš„è¯ç‰©ç›¸äº’ä½œç”¨è­¦ç¤º</p>
                                    </div>
                                    <div class="drug-interaction-grid" id="drugInteractionGrid">
                                        <!-- è¯ç‰©ç›¸äº’ä½œç”¨å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                                    </div>
                                </div>

                                <!-- è¡€æ¶²åˆ¶å“è¿½æº¯ -->
                                <div class="sidebar-panel">
                                    <div class="panel-header">
                                        <h3 class="panel-title">è¡€æ¶²åˆ¶å“è¿½æº¯</h3>
                                        <p class="panel-subtitle">è¡€æ¶²åˆ¶å“ä½¿ç”¨çŠ¶æ€ç›‘æ§</p>
                                    </div>
                                    <div class="blood-tracking" id="bloodTracking">
                                        <!-- è¡€æ¶²è¿½æº¯ä¿¡æ¯å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- è¯¦ç»†æ•°æ®è¡¨æ ¼ -->
                        <div class="data-table">
                            <div class="table-header">
                                <h3>ç§‘å®¤è¯äº‹ä¸è¡€æ¶²ç®¡ç†è¯¦æƒ…</h3>
                                <div class="table-controls">
                                    <div class="search-box">
                                        <input type="text" placeholder="æœç´¢ç§‘å®¤æˆ–è¯ç‰©ç±»å‹..." id="searchInput">
                                        <span class="search-icon">ğŸ”</span>
                                    </div>
                                    <select class="filter-select" id="departmentFilter">
                                        <option value="all">å…¨éƒ¨ç§‘å®¤</option>
                                        <option value="internal">å†…ç§‘ç³»ç»Ÿ</option>
                                        <option value="surgical">å¤–ç§‘ç³»ç»Ÿ</option>
                                        <option value="emergency">æ€¥è¯Šç§‘</option>
                                        <option value="icu">é‡ç—‡åŒ»å­¦ç§‘</option>
                                    </select>
                                </div>
                            </div>
                            <div class="table-wrapper">
                                <table class="quality-table">
                                    <thead>
                                        <tr>
                                            <th>ç§‘å®¤åç§°</th>
                                            <th>åˆç†ç”¨è¯ç‡</th>
                                            <th>è¡€æ¶²åˆ¶å“åˆè§„ç‡</th>
                                            <th>ä¸è‰¯ååº”ç›‘æµ‹ç‡</th>
                                            <th>æŠ—èŒè¯ç‰©ä½¿ç”¨å¼ºåº¦</th>
                                            <th>è¾“è¡€å‰æ£€æŸ¥ç‡</th>
                                            <th>ç»¼åˆè¯„çº§</th>
                                        </tr>
                                    </thead>
                                    <tbody id="dataTableBody">
                                        <!-- è¡¨æ ¼æ•°æ®å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </main>
            </div>
        </div>
    </div>

    <script>
        class PharmacyBloodMonitor {
            constructor() {
                this.currentChart = 'trend';
                this.init();
            }

            async init() {
                try {
                    console.log('å¼€å§‹åˆå§‹åŒ–è¯ç‰©ä¸è¡€æ¶²ç®¡ç†ç›‘æ§é¡µé¢...');
                    
                    // ç¡®ä¿EChartså·²åŠ è½½
                    await Common.ensureEcharts();
                    
                    this.generateRealTimeData();
                    this.generateStatCards();
                    this.generateIndicatorList();
                    this.generateDrugInteractions();
                    this.generateBloodTracking();
                    this.generateDataTable();
                    this.initCharts();
                    this.bindEvents();
                    this.startRealTimeUpdates();
                    
                    console.log('è¯ç‰©ä¸è¡€æ¶²ç®¡ç†ç›‘æ§é¡µé¢åˆå§‹åŒ–å®Œæˆ');
                } catch (error) {
                    console.error('è¯ç‰©ä¸è¡€æ¶²ç®¡ç†ç›‘æ§é¡µé¢åˆå§‹åŒ–å¤±è´¥:', error);
                }
            }

            generateRealTimeData() {
                const data = window.medicalDataSimulator.generatePharmacyBloodData();
                document.getElementById('activePrescriptions').textContent = data.activePrescriptions;
                document.getElementById('bloodUnitsAvailable').textContent = data.bloodUnitsAvailable;
                document.getElementById('adverseEvents').textContent = data.adverseEvents;
                document.getElementById('inventoryTurnover').textContent = data.inventoryTurnover + '%';
                document.getElementById('lastUpdate').textContent = new Date().toLocaleTimeString();
            }

            generateStatCards() {
                const stats = [
                    {
                        title: 'åˆç†ç”¨è¯ç‡',
                        value: '96.2%',
                        change: 'â†‘ 1.8% è¾ƒä¸Šæœˆ',
                        changeType: 'positive',
                        icon: 'ğŸ’Š',
                        type: 'medication'
                    },
                    {
                        title: 'è¡€æ¶²åˆ¶å“ä½¿ç”¨åˆè§„ç‡',
                        value: '98.7%',
                        change: 'â†‘ 0.5% è¾ƒä¸Šæœˆ',
                        changeType: 'positive',
                        icon: 'ğŸ©¸',
                        type: 'blood'
                    },
                    {
                        title: 'è¯ç‰©ä¸è‰¯ååº”ç›‘æµ‹ç‡',
                        value: '92.4%',
                        change: 'â†“ 0.3% è¾ƒä¸Šæœˆ',
                        changeType: 'negative',
                        icon: 'âš ï¸',
                        type: 'adverse'
                    },
                    {
                        title: 'æŠ—èŒè¯ç‰©ä½¿ç”¨å¼ºåº¦',
                        value: '38.5',
                        change: 'â†“ 2.1 è¾ƒä¸Šæœˆ',
                        changeType: 'positive',
                        icon: 'ğŸ¦ ',
                        type: 'antibiotic'
                    }
                ];

                const statsGrid = document.getElementById('statsGrid');
                statsGrid.innerHTML = stats.map(stat => `
                    <div class="stat-card ${stat.type}" data-stat="${stat.title}">
                        <div class="stat-header">
                            <div class="stat-title">${stat.title}</div>
                            <div class="stat-icon">${stat.icon}</div>
                        </div>
                        <div class="stat-value">${stat.value}</div>
                        <div class="stat-change ${stat.changeType}">${stat.change}</div>
                    </div>
                `).join('');
            }

            generateIndicatorList() {
                const indicators = [
                    { name: 'åˆç†ç”¨è¯ç‡', value: '96.2%', trend: 'up', status: 'good' },
                    { name: 'è¡€æ¶²åˆ¶å“åˆè§„ç‡', value: '98.7%', trend: 'up', status: 'good' },
                    { name: 'è¯ç‰©ä¸è‰¯ååº”ç›‘æµ‹ç‡', value: '92.4%', trend: 'down', status: 'warning' },
                    { name: 'æŠ—èŒè¯ç‰©ä½¿ç”¨å¼ºåº¦', value: '38.5', trend: 'down', status: 'good' },
                    { name: 'è¡€æ¶²åˆ¶å“åº“å­˜å‘¨è½¬ç‡', value: '12.3', trend: 'up', status: 'good' },
                    { name: 'è¯ç‰©é…ä¼ç¦å¿Œæ£€æŸ¥ç‡', value: '99.1%', trend: 'stable', status: 'good' },
                    { name: 'è¾“è¡€å‰æ£€æŸ¥å®Œæˆç‡', value: '99.8%', trend: 'stable', status: 'good' },
                    { name: 'ç‰¹æ®Šçº§æŠ—èŒè¯ç‰©ä¼šè¯Šç‡', value: '95.6%', trend: 'up', status: 'good' }
                ];

                const indicatorList = document.getElementById('indicatorList');
                indicatorList.innerHTML = indicators.map(indicator => `
                    <div class="indicator-item">
                        <div class="indicator-name">${indicator.name}</div>
                        <div class="indicator-value">
                            <span class="indicator-number ${indicator.status}">${indicator.value}</span>
                            <span class="indicator-trend ${indicator.trend}">
                                ${indicator.trend === 'up' ? 'â†‘' : indicator.trend === 'down' ? 'â†“' : 'â†’'}
                            </span>
                        </div>
                    </div>
                `).join('');
            }

            generateDrugInteractions() {
                const interactions = [
                    { drugs: 'åæ³•æ—+é˜¿å¸åŒ¹æ—', risk: 'high-risk', level: 'é«˜é£é™©' },
                    { drugs: 'åœ°é«˜è¾›+èƒºç¢˜é…®', risk: 'high-risk', level: 'é«˜é£é™©' },
                    { drugs: 'ç¾æ‰˜æ´›å°”+ç»´æ‹‰å¸•ç±³', risk: 'medium-risk', level: 'ä¸­é£é™©' },
                    { drugs: 'æ°¨æ°¯åœ°å¹³+è¾›ä¼ä»–æ±€', risk: 'medium-risk', level: 'ä¸­é£é™©' },
                    { drugs: 'å¥¥ç¾æ‹‰å”‘+æ°¯å¡æ ¼é›·', risk: 'low-risk', level: 'ä½é£é™©' },
                    { drugs: 'é˜¿æ‰˜ä¼ä»–æ±€+çº¢éœ‰ç´ ', risk: 'low-risk', level: 'ä½é£é™©' }
                ];

                const drugInteractionGrid = document.getElementById('drugInteractionGrid');
                drugInteractionGrid.innerHTML = interactions.map(interaction => `
                    <div class="interaction-item ${interaction.risk}">
                        <div style="font-weight: 600; margin-bottom: 4px;">${interaction.drugs}</div>
                        <div style="color: #6c757d;">${interaction.level}</div>
                    </div>
                `).join('');
            }

            generateBloodTracking() {
                const bloodProducts = [
                    { id: 'RBC-2024-001', type: 'çº¢ç»†èƒ', status: 'in-use', statusText: 'ä½¿ç”¨ä¸­' },
                    { id: 'PLT-2024-002', type: 'è¡€å°æ¿', status: 'available', statusText: 'å¯ç”¨' },
                    { id: 'FFP-2024-003', type: 'æ–°é²œå†°å†»è¡€æµ†', status: 'available', statusText: 'å¯ç”¨' },
                    { id: 'RBC-2024-004', type: 'çº¢ç»†èƒ', status: 'expired', statusText: 'å³å°†è¿‡æœŸ' },
                    { id: 'PLT-2024-005', type: 'è¡€å°æ¿', status: 'in-use', statusText: 'ä½¿ç”¨ä¸­' }
                ];

                const bloodTracking = document.getElementById('bloodTracking');
                bloodTracking.innerHTML = bloodProducts.map(product => `
                    <div class="tracking-item">
                        <div class="tracking-info">
                            <div class="tracking-id">${product.id}</div>
                            <div class="tracking-status">${product.type}</div>
                        </div>
                        <div class="tracking-badge ${product.status}">${product.statusText}</div>
                    </div>
                `).join('');
            }

            generateDataTable() {
                const departments = [
                    {
                        name: 'å¿ƒè¡€ç®¡å†…ç§‘',
                        medicationRate: '98.5%',
                        bloodCompliance: '99.2%',
                        adverseMonitoring: '95.8%',
                        antibioticIntensity: '35.2',
                        transfusionCheck: '100%',
                        rating: 'excellent'
                    },
                    {
                        name: 'ç¥ç»å¤–ç§‘',
                        medicationRate: '96.8%',
                        bloodCompliance: '98.9%',
                        adverseMonitoring: '93.5%',
                        antibioticIntensity: '42.1',
                        transfusionCheck: '99.8%',
                        rating: 'excellent'
                    },
                    {
                        name: 'é‡ç—‡åŒ»å­¦ç§‘',
                        medicationRate: '95.2%',
                        bloodCompliance: '98.1%',
                        adverseMonitoring: '91.7%',
                        antibioticIntensity: '45.8',
                        transfusionCheck: '99.5%',
                        rating: 'good'
                    },
                    {
                        name: 'æ€¥è¯Šç§‘',
                        medicationRate: '93.7%',
                        bloodCompliance: '97.3%',
                        adverseMonitoring: '89.2%',
                        antibioticIntensity: '48.5',
                        transfusionCheck: '99.1%',
                        rating: 'warning'
                    },
                    {
                        name: 'å‘¼å¸å†…ç§‘',
                        medicationRate: '94.9%',
                        bloodCompliance: '98.6%',
                        adverseMonitoring: '92.8%',
                        antibioticIntensity: '41.3',
                        transfusionCheck: '99.7%',
                        rating: 'good'
                    },
                    {
                        name: 'æ¶ˆåŒ–å†…ç§‘',
                        medicationRate: '97.1%',
                        bloodCompliance: '98.4%',
                        adverseMonitoring: '94.2%',
                        antibioticIntensity: '37.9',
                        transfusionCheck: '99.9%',
                        rating: 'excellent'
                    }
                ];

                const ratingText = {
                    'excellent': 'ä¼˜ç§€',
                    'good': 'è‰¯å¥½',
                    'warning': 'å¾…æ”¹è¿›',
                    'danger': 'éœ€æ”¹è¿›'
                };

                const tableBody = document.getElementById('dataTableBody');
                tableBody.innerHTML = departments.map(dept => `
                    <tr>
                        <td>${dept.name}</td>
                        <td>${dept.medicationRate}</td>
                        <td>${dept.bloodCompliance}</td>
                        <td>${dept.adverseMonitoring}</td>
                        <td>${dept.antibioticIntensity}</td>
                        <td>${dept.transfusionCheck}</td>
                        <td><span class="status-badge ${dept.rating}">${ratingText[dept.rating]}</span></td>
                    </tr>
                `).join('');
            }

            initCharts() {
                this.initTrendChart();
            }

            initTrendChart() {
                const chart = echarts.init(document.getElementById('mainChart'));
                const option = {
                    title: {
                        text: 'è¯äº‹ä¸è¡€æ¶²ç®¡ç†æŒ‡æ ‡è¶‹åŠ¿',
                        left: 'center',
                        textStyle: {
                            fontSize: 16,
                            fontWeight: 'normal',
                            color: '#2c3e50'
                        }
                    },
                    tooltip: {
                        trigger: 'axis',
                        axisPointer: {
                            type: 'cross'
                        }
                    },
                    legend: {
                        data: ['åˆç†ç”¨è¯ç‡', 'è¡€æ¶²åˆ¶å“åˆè§„ç‡', 'ä¸è‰¯ååº”ç›‘æµ‹ç‡', 'æŠ—èŒè¯ç‰©ä½¿ç”¨å¼ºåº¦'],
                        bottom: 10
                    },
                    grid: {
                        left: '3%',
                        right: '4%',
                        bottom: '15%',
                        top: '15%',
                        containLabel: true
                    },
                    xAxis: {
                        type: 'category',
                        boundaryGap: false,
                        data: ['1æœˆ', '2æœˆ', '3æœˆ', '4æœˆ', '5æœˆ', '6æœˆ', '7æœˆ', '8æœˆ', '9æœˆ', '10æœˆ', '11æœˆ', '12æœˆ']
                    },
                    yAxis: [
                        {
                            type: 'value',
                            name: 'ç™¾åˆ†æ¯”(%)',
                            min: 85,
                            max: 100,
                            position: 'left',
                            axisLabel: {
                                formatter: '{value}%'
                            }
                        },
                        {
                            type: 'value',
                            name: 'ä½¿ç”¨å¼ºåº¦',
                            min: 30,
                            max: 50,
                            position: 'right',
                            axisLabel: {
                                formatter: '{value}'
                            }
                        }
                    ],
                    series: [
                        {
                            name: 'åˆç†ç”¨è¯ç‡',
                            type: 'line',
                            smooth: true,
                            yAxisIndex: 0,
                            data: [94.1, 94.5, 94.8, 95.2, 95.5, 95.8, 96.0, 96.1, 96.2, 96.2, 96.2, 96.2],
                            itemStyle: { color: '#28a745' }
                        },
                        {
                            name: 'è¡€æ¶²åˆ¶å“åˆè§„ç‡',
                            type: 'line',
                            smooth: true,
                            yAxisIndex: 0,
                            data: [97.8, 98.0, 98.2, 98.3, 98.4, 98.5, 98.6, 98.7, 98.7, 98.7, 98.7, 98.7],
                            itemStyle: { color: '#dc3545' }
                        },
                        {
                            name: 'ä¸è‰¯ååº”ç›‘æµ‹ç‡',
                            type: 'line',
                            smooth: true,
                            yAxisIndex: 0,
                            data: [91.2, 91.5, 91.8, 92.1, 92.4, 92.7, 92.8, 92.7, 92.6, 92.4, 92.4, 92.4],
                            itemStyle: { color: '#ffc107' }
                        },
                        {
                            name: 'æŠ—èŒè¯ç‰©ä½¿ç”¨å¼ºåº¦',
                            type: 'line',
                            smooth: true,
                            yAxisIndex: 1,
                            data: [42.1, 41.8, 41.5, 41.2, 40.8, 40.5, 40.1, 39.8, 39.2, 38.5, 38.5, 38.5],
                            itemStyle: { color: '#6f42c1' }
                        }
                    ]
                };
                chart.setOption(option);
                this.mainChart = chart;

                // å“åº”å¼å¤„ç†
                window.addEventListener('resize', () => {
                    chart.resize();
                });
            }

            bindEvents() {
                // å›¾è¡¨æ§åˆ¶æŒ‰é’®äº‹ä»¶
                document.querySelectorAll('.chart-control-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        document.querySelectorAll('.chart-control-btn').forEach(b => b.classList.remove('active'));
                        e.target.classList.add('active');
                        this.currentChart = e.target.dataset.chart;
                        this.updateChart();
                    });
                });

                // ç»Ÿè®¡å¡ç‰‡ç‚¹å‡»äº‹ä»¶
                document.querySelectorAll('.stat-card').forEach(card => {
                    card.addEventListener('click', (e) => {
                        const statTitle = e.currentTarget.dataset.stat;
                        console.log(`é€‰ä¸­ç»Ÿè®¡æŒ‡æ ‡: ${statTitle}`);
                        this.highlightChartSeries(statTitle);
                    });
                });

                // è¡¨æ ¼è¡Œç‚¹å‡»äº‹ä»¶
                document.querySelectorAll('.quality-table tbody tr').forEach(row => {
                    row.addEventListener('click', (e) => {
                        document.querySelectorAll('.quality-table tbody tr').forEach(r => r.classList.remove('selected'));
                        e.currentTarget.classList.add('selected');
                        
                        const cells = e.currentTarget.querySelectorAll('td');
                        const rowData = {
                            department: cells[0]?.textContent,
                            medicationRate: cells[1]?.textContent,
                            bloodCompliance: cells[2]?.textContent,
                            adverseMonitoring: cells[3]?.textContent,
                            antibioticIntensity: cells[4]?.textContent,
                            transfusionCheck: cells[5]?.textContent,
                            rating: cells[6]?.textContent
                        };
                        
                        console.log('é€‰ä¸­ç§‘å®¤æ•°æ®:', rowData);
                    });
                });

                // æœç´¢åŠŸèƒ½
                document.getElementById('searchInput').addEventListener('input', (e) => {
                    this.filterTable(e.target.value);
                });

                // ç§‘å®¤ç­›é€‰
                document.getElementById('departmentFilter').addEventListener('change', (e) => {
                    this.filterByDepartment(e.target.value);
                });
            }

            updateChart() {
                // æ ¹æ®å½“å‰é€‰æ‹©çš„å›¾è¡¨ç±»å‹æ›´æ–°å›¾è¡¨
                if (this.currentChart === 'safety') {
                    this.initSafetyChart();
                } else if (this.currentChart === 'blood') {
                    this.initBloodChart();
                } else {
                    this.initTrendChart();
                }
            }

            initSafetyChart() {
                const option = {
                    title: {
                        text: 'ç”¨è¯å®‰å…¨æŒ‡æ ‡åˆ†æ',
                        left: 'center',
                        textStyle: {
                            fontSize: 16,
                            fontWeight: 'normal',
                            color: '#2c3e50'
                        }
                    },
                    tooltip: {
                        trigger: 'item'
                    },
                    legend: {
                        orient: 'vertical',
                        left: 'left'
                    },
                    series: [
                        {
                            name: 'ç”¨è¯å®‰å…¨æŒ‡æ ‡',
                            type: 'pie',
                            radius: '50%',
                            data: [
                                { value: 96.2, name: 'åˆç†ç”¨è¯ç‡' },
                                { value: 92.4, name: 'ä¸è‰¯ååº”ç›‘æµ‹ç‡' },
                                { value: 99.1, name: 'é…ä¼ç¦å¿Œæ£€æŸ¥ç‡' },
                                { value: 95.6, name: 'ç‰¹æ®Šçº§æŠ—èŒè¯ç‰©ä¼šè¯Šç‡' }
                            ],
                            emphasis: {
                                itemStyle: {
                                    shadowBlur: 10,
                                    shadowOffsetX: 0,
                                    shadowColor: 'rgba(0, 0, 0, 0.5)'
                                }
                            }
                        }
                    ]
                };
                this.mainChart.setOption(option);
            }

            initBloodChart() {
                const option = {
                    title: {
                        text: 'è¡€æ¶²ç®¡ç†æŒ‡æ ‡åˆ†æ',
                        left: 'center',
                        textStyle: {
                            fontSize: 16,
                            fontWeight: 'normal',
                            color: '#2c3e50'
                        }
                    },
                    tooltip: {
                        trigger: 'axis'
                    },
                    legend: {
                        data: ['è¡€æ¶²åˆ¶å“åˆè§„ç‡', 'è¾“è¡€å‰æ£€æŸ¥ç‡', 'åº“å­˜å‘¨è½¬ç‡'],
                        bottom: 10
                    },
                    grid: {
                        left: '3%',
                        right: '4%',
                        bottom: '15%',
                        top: '15%',
                        containLabel: true
                    },
                    xAxis: {
                        type: 'category',
                        data: ['çº¢ç»†èƒ', 'è¡€å°æ¿', 'æ–°é²œå†°å†»è¡€æµ†', 'å†·æ²‰æ·€', 'å…¨è¡€']
                    },
                    yAxis: {
                        type: 'value',
                        axisLabel: {
                            formatter: '{value}%'
                        }
                    },
                    series: [
                        {
                            name: 'è¡€æ¶²åˆ¶å“åˆè§„ç‡',
                            type: 'bar',
                            data: [98.7, 97.5, 99.1, 96.8, 98.2],
                            itemStyle: { color: '#dc3545' }
                        },
                        {
                            name: 'è¾“è¡€å‰æ£€æŸ¥ç‡',
                            type: 'bar',
                            data: [99.8, 99.5, 99.9, 99.2, 99.6],
                            itemStyle: { color: '#28a745' }
                        },
                        {
                            name: 'åº“å­˜å‘¨è½¬ç‡',
                            type: 'line',
                            data: [12.3, 15.8, 8.9, 6.2, 4.1],
                            itemStyle: { color: '#17a2b8' }
                        }
                    ]
                };
                this.mainChart.setOption(option);
            }

            highlightChartSeries(seriesName) {
                // é«˜äº®é€‰ä¸­çš„æ•°æ®ç³»åˆ—
                console.log(`é«˜äº®å›¾è¡¨ç³»åˆ—: ${seriesName}`);
            }

            filterTable(searchTerm) {
                const rows = document.querySelectorAll('.quality-table tbody tr');
                rows.forEach(row => {
                    const text = row.textContent.toLowerCase();
                    if (text.includes(searchTerm.toLowerCase())) {
                        row.style.display = '';
                    } else {
                        row.style.display = 'none';
                    }
                });
            }

            filterByDepartment(department) {
                const rows = document.querySelectorAll('.quality-table tbody tr');
                rows.forEach(row => {
                    if (department === 'all') {
                        row.style.display = '';
                    } else {
                        const deptName = row.cells[0].textContent;
                        const shouldShow = this.matchesDepartmentFilter(deptName, department);
                        row.style.display = shouldShow ? '' : 'none';
                    }
                });
            }

            matchesDepartmentFilter(deptName, filter) {
                const filters = {
                    'internal': ['å†…ç§‘', 'å¿ƒè¡€ç®¡', 'å‘¼å¸', 'æ¶ˆåŒ–', 'ç¥ç»å†…ç§‘', 'å†…åˆ†æ³Œ'],
                    'surgical': ['å¤–ç§‘', 'ç¥ç»å¤–ç§‘', 'éª¨ç§‘', 'æ³Œå°¿å¤–ç§‘', 'èƒ¸å¤–ç§‘'],
                    'emergency': ['æ€¥è¯Š'],
                    'icu': ['é‡ç—‡', 'ICU']
                };
                
                if (!filters[filter]) return true;
                
                return filters[filter].some(keyword => deptName.includes(keyword));
            }

            startRealTimeUpdates() {
                setInterval(() => {
                    this.generateRealTimeData();
                }, 30000); // æ¯30ç§’æ›´æ–°ä¸€æ¬¡
            }
        }

        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            // åˆå§‹åŒ–æ•°æ®æ¨¡æ‹Ÿå™¨
            window.medicalDataSimulator = new MedicalDataSimulator();
            
            const monitor = new PharmacyBloodMonitor();
            console.log('è¯äº‹ä¸è¡€æ¶²ç®¡ç†é¡µé¢åˆå§‹åŒ–å®Œæˆ');
        });
    </script>
</body>
</html>