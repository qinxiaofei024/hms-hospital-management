/*! time: 2025/9/2 15:53:22; branch: master describe: a5a458eaa commit: a5a458eaa9bf68029f66b1a68081ce87c8783674 */
var e=Object.defineProperty,t=(t,n,a)=>((t,n,a)=>n in t?e(t,n,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[n]=a)(t,"symbol"!=typeof n?n+"":n,a);function n(){import.meta.url,import("_").catch((()=>1)),async function*(){}().next()}import{r as a,b2 as o,bY as r,bU as s,cz as i,j as c,k as l,m as d,at as m,cA as u,o as p,h,F as g,ae as f,X as w,c8 as v,cB as y,D as C,c4 as S,aJ as b,b7 as _,bd as E,a3 as I,b_ as T,s as k,ah as M,ab as N,aH as L,af as x,aU as A,cC as R,q as P,ad as D,c1 as z,ca as O,cm as j,cn as B,co as U,cp as W,cq as F,cw as G,cx as H,cy as V}from"./resource?resource=/com/fr/plugin/wysiwyg/web/static/js/utils-hash-BZGqdNop.js";import{bf as K,w as J,bg as Y,a as q,bh as X,bi as Z,h as Q,bj as $,bk as ee,bl as te,bm as ne,aT as ae,aU as oe,aW as re,aJ as se,aX as ie,aY as ce,aZ as le,bb as de,bn as me,bd as ue,bo as pe,ag as he,bp as ge}from"./resource?resource=/com/fr/plugin/wysiwyg/web/static/js/setAppConfig-hash-DSmqnnw2.js";import{c as fe,d as we}from"./resource?resource=/com/fr/plugin/wysiwyg/web/static/js/shared-hash-QGZb_1OY.js";import{T as ve,u as ye,a as Ce,b as Se}from"./resource?resource=/com/fr/plugin/wysiwyg/web/static/js/index-hash-Bf6mcu9N.js";import{S as be}from"./resource?resource=/com/fr/plugin/wysiwyg/web/static/js/polyfill-hash-Cs1uKvqB.js";import{C as _e}from"./resource?resource=/com/fr/plugin/wysiwyg/web/static/js/CanvasPainter-hash-C9zXrXqV.js";import{u as Ee}from"./resource?resource=/com/fr/plugin/wysiwyg/web/static/js/useControllerStyles-hash-DdpwKTcR.js";import"./resource?resource=/com/fr/plugin/wysiwyg/web/static/js/indexOf-hash-DlluUZiX.js";const Ie=e=>a.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 1024 1024",width:"1em",height:"1em",...e},a.createElement("path",{d:"M192 192v640h192v-115.2c0-7.04 5.76-12.8 12.8-12.8h38.4c7.04 0 12.8 5.76 12.8 12.8v166.4a12.8 12.8 0 0 1-9.408 12.352L435.2 896H140.8a12.8 12.8 0 0 1-12.8-12.8V140.8c0-7.04 5.76-12.8 12.8-12.8h294.4c7.04 0 12.8 5.76 12.8 12.8v166.4a12.8 12.8 0 0 1-12.8 12.8h-38.4a12.8 12.8 0 0 1-12.8-12.8V192H192z m448 0v115.2a12.8 12.8 0 0 1-12.8 12.8h-38.4a12.8 12.8 0 0 1-12.8-12.8V140.8a12.8 12.8 0 0 1 9.408-12.352L588.8 128h294.4c7.04 0 12.8 5.76 12.8 12.8v742.4a12.8 12.8 0 0 1-12.8 12.8H588.8a12.8 12.8 0 0 1-12.8-12.8v-166.4c0-7.04 5.76-12.8 12.8-12.8h38.4c7.04 0 12.8 5.76 12.8 12.8V832h192V192h-192z m-201.664 454.464a12.8 12.8 0 0 1-18.112 0l-27.2-27.136a12.8 12.8 0 0 1 0-18.112l81.472-81.472-81.472-81.408a12.8 12.8 0 0 1 0-18.112l27.2-27.2a12.736 12.736 0 0 1 7.04-3.584h3.968c2.56 0.384 5.12 1.6 7.04 3.584l81.472 81.472 81.472-81.472a12.8 12.8 0 0 1 18.112 0l27.136 27.2a12.8 12.8 0 0 1 0 18.112L564.992 519.68l81.472 81.472a12.8 12.8 0 0 1 0 18.112l-27.136 27.136a12.8 12.8 0 0 1-18.112 0L519.744 564.992l-81.408 81.472z"})),Te=e=>a.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 1024 1024",width:"1em",height:"1em",...e},a.createElement("path",{d:"M563.84 512l262.4-312.96a7.936 7.936 0 0 0-6.016-13.056h-79.808a16.256 16.256 0 0 0-12.288 5.76L511.616 449.728 295.04 191.68a16 16 0 0 0-12.288-5.696H203.008a7.936 7.936 0 0 0-6.08 13.12L459.392 512l-262.464 312.96a7.936 7.936 0 0 0 6.08 13.056h79.808a16.32 16.32 0 0 0 12.288-5.76l216.512-258.048 216.512 258.112a16 16 0 0 0 12.288 5.696h79.808a7.936 7.936 0 0 0 6.08-13.12L563.776 512z"})),ke=e=>a.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 1024 1024",width:"1em",height:"1em",...e},a.createElement("path",{d:"M731.2384 179.2H293.248a113.9968 113.9968 0 0 0-105.2416 69.8624 113.536 113.536 0 0 0-6.5792 66.2784l1.3824 5.9904c5.12 19.84 15.5648 37.9392 30.208 52.4032l162.56 161.1008 0.0256 136.4992a113.664 113.664 0 0 0 33.5616 80.5888l63.4368 62.8736a103.3728 103.3728 0 0 0 111.9232 22.272 103.1168 103.1168 0 0 0 46.336-37.7088l3.2768-5.1712c9.3696-15.8208 14.336-33.8944 14.336-52.352V534.784l165.1456-162.5344 5.2992-7.2704-1.8688 2.304a113.6128 113.6128 0 0 0-23.04-169.0368A113.9968 113.9968 0 0 0 731.2384 179.2zM293.12 274.2784h438.016a18.7904 18.7904 0 0 1 17.152 11.52 18.432 18.432 0 0 1-3.072 19.2256l-2.4576 3.072-1.3568 1.8432-161.92 159.4368a87.552 87.552 0 0 0-26.0352 62.1312v210.2784a7.9104 7.9104 0 0 1-4.992 7.3216 8.1152 8.1152 0 0 1-8.6016-1.5616L476.16 684.4672a18.5344 18.5344 0 0 1-5.4528-13.1328v-139.8272a87.296 87.296 0 0 0-25.984-62.0288l-164.8384-163.328a18.688 18.688 0 0 1-4.1728-20.3776 18.6624 18.6624 0 0 1 17.408-11.4944z"})),Me=e=>a.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 1024 1024",width:"1em",height:"1em",...e},a.createElement("path",{d:"M800.256 212.4032l36.864 36.7616a25.9328 25.9328 0 0 1 0 36.7616L597.504 524.8l239.6416 238.8736a25.9328 25.9328 0 0 1 0 36.7616l-36.864 36.7616a26.112 26.112 0 0 1-36.864 0L468.4288 543.1808a25.9328 25.9328 0 0 1 0-36.7616L763.392 212.4032a26.112 26.112 0 0 1 36.864 0z m-307.2 0l36.8896 36.7616a25.9328 25.9328 0 0 1 0 36.7616L290.304 524.8l239.6672 238.8736a25.9328 25.9328 0 0 1 0 36.7616l-36.864 36.7616a26.112 26.112 0 0 1-36.864 0L161.2032 543.1808a25.9328 25.9328 0 0 1 0-36.7616L456.192 212.4032a26.112 26.112 0 0 1 36.864 0z"})),Ne=e=>a.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 1024 1024",width:"1em",height:"1em",...e},a.createElement("path",{d:"M302.9504 230.4c2.3296 0 4.2496 7.7824 4.2496 17.28v67.84c0 9.4976-1.92 17.28-4.2496 17.28H209.0496C206.72 332.8 204.8 325.0176 204.8 315.52v-67.84C204.8 238.1824 206.72 230.4 209.0496 230.4h93.9008zM844.8 708.48c0-9.4976-8.1408-17.28-18.0992-17.28H427.6992c-9.9584 0-18.0992 7.7824-18.0992 17.28v67.84c0 9.4976 8.1408 17.28 18.0992 17.28h399.0016c9.9584 0 18.0992-7.7824 18.0992-17.28v-67.84zM844.8 247.68c0-9.4976-8.1408-17.28-18.0992-17.28H427.6992c-9.9584 0-18.0992 7.7824-18.0992 17.28v67.84c0 9.4976 8.1408 17.28 18.0992 17.28h399.0016c9.9584 0 18.0992-7.7824 18.0992-17.28v-67.84zM307.2 478.08c0-9.4976-1.92-17.28-4.2496-17.28H209.0496c-2.3296 0-4.2496 7.7824-4.2496 17.28v67.84c0 9.4976 1.92 17.28 4.2496 17.28h93.9008c2.3296 0 4.2496-7.7824 4.2496-17.28v-67.84zM302.9504 691.2c2.3296 0 4.2496 7.7824 4.2496 17.28v67.84c0 9.4976-1.92 17.28-4.2496 17.28H209.0496C206.72 793.6 204.8 785.8176 204.8 776.32v-67.84c0-9.4976 1.92-17.28 4.2496-17.28h93.9008zM844.8 478.08c0-9.4976-8.1408-17.28-18.0992-17.28H427.6992c-9.9584 0-18.0992 7.7824-18.0992 17.28v67.84c0 9.4976 8.1408 17.28 18.0992 17.28h399.0016c9.9584 0 18.0992-7.7824 18.0992-17.28v-67.84z"})),Le=e=>a.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 1024 1024",width:"1em",height:"1em",...e},a.createElement("path",{d:"M530.944 212.4032a26.112 26.112 0 0 1 36.864 0l294.9632 294.016a25.9328 25.9328 0 0 1 0 36.7616L567.7824 837.1968a26.112 26.112 0 0 1-36.864 0l-36.864-36.7616a25.9328 25.9328 0 0 1 0-36.7616l239.616-238.8736-239.616-238.8736a25.9328 25.9328 0 0 1 0-36.7616z m-307.2 0a26.112 26.112 0 0 1 36.864 0l294.9632 294.016a25.9328 25.9328 0 0 1 0 36.7616L260.608 837.1968a26.112 26.112 0 0 1-36.864 0l-36.8896-36.7616a25.9328 25.9328 0 0 1 0-36.7616L426.496 524.8 186.88 285.9264a25.9328 25.9328 0 0 1 0-36.7616z"})),xe=e=>a.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 1024 1024",width:"1em",height:"1em",...e},a.createElement("path",{d:"M444.7488 765.1328a23.296 23.296 0 0 1-23.2192 23.2192h-91.136a23.296 23.296 0 0 1-23.1936-23.2192V253.5936A23.296 23.296 0 0 1 330.3936 230.4h91.136a23.296 23.296 0 0 1 23.2192 23.1936v511.5392zM710.016 765.1328a23.296 23.296 0 0 1-23.2192 23.2192h-91.136a23.296 23.296 0 0 1-23.1936-23.2192V253.5936A23.296 23.296 0 0 1 595.6864 230.4h91.136a23.296 23.296 0 0 1 23.1936 23.1936v511.5392z"})),Ae=["d-calder","d-calder-custom","d-unity","d-chart-GEO_LAND","d-chart-BAR_3D_ON_GLOBE","d-chart-SCATTER_3D_ON_GLOBE","d-chart-LINES_3D_ON_GLOBE","d-chart-PARTICLE","d-chart-CAROUSEL_CATALOG","d-chart-GROUP_MAP","d-chart-SLIDE_SHOW_MAP"],Re="Server Info",Pe="Basic Info",De="fps_KEY",ze="longtask_KEY",Oe=[De],je="__monitor_type__",Be="__scene_name__",Ue="record",We="source",Fe="scene.json",Ge="start",He="end",Ve="record";function Ke(){const e=document.createElement("canvas"),t=e.getContext("webgl")||e.getContext("experimental-webgl")||e.getContext("webgl2")||e.getContext("experimental-webgl2");if(!t)return[at("error","no webgl")];const n=t.getExtension("WEBGL_debug_renderer_info");return n?[at("WEBGL renderer",t.getParameter(n.UNMASKED_RENDERER_WEBGL)),at("WEBGL vendor",t.getParameter(n.UNMASKED_VENDOR_WEBGL))]:[at("error","no WEBGL_debug_renderer_info")]}function Je(){const{performance:e}=window;if(!e)return[];const t=e.getEntriesByName("whiteScreen","mark"),n=e.timing;return[at("ttfb(ms)",n.responseStart-n.navigationStart,"TIMING_TTFB_KEY"),at("fcp(ms)",(t&&1===t.length?t[0].startTime+e.timeOrigin:n.domLoading)-n.navigationStart,"TIMING_WHITE_SCREEN_KEY"),at("dom",n.domComplete-n.domLoading)]}function Ye(){let e=0,t=0,n=0,a=0;const o=[];return performance.getEntries().forEach((r=>{r instanceof PerformanceResourceTiming&&(e+=r.duration,t=t+r.responseEnd-r.requestStart,n++,a+=r.encodedBodySize,r.transferSize>1048576&&o.push(r.name))})),at("All Request Information","Average Time(ms): ".concat(rt(e/n),", Average Download Time(ms): ").concat(rt(t/n),", Request Count: ").concat(n,", Total Request Size(B): ").concat(a,", Uncached Requests: ").concat(JSON.stringify(o)))}function qe(){return at("dom count",document.querySelectorAll("*").length,"dom_size_KEY")}function Xe(){return at("usedJSHeapSize(MB)",rt(performance.memory.usedJSHeapSize/1048576),"usedJSHeapSize_KEY")}function Ze(){var e;return{name:Pe,items:[at("jsHeapSizeLimit(MB)",rt(performance.memory.jsHeapSizeLimit/1048576)),at("downlink(Mbps)",null==(e=navigator.connection)?void 0:e.downlink,"downlink_KEY"),qe(),Xe(),Ye()].concat(Ke()).concat(Je())}}function Qe(e){let t,n=ct(),a=ct(),o=0;const r=()=>{o++;const s=ct();s>=n+1e3&&(e(at("fps",rt(1e3*o/(s-n)),De)),e(Xe()),o=0,n=s),s>=a+6e5&&(e(qe()),a=s),t=requestAnimationFrame(r)};r();const s=function(e){let t=0;const n=new PerformanceObserver((n=>{const a=n.getEntries();for(const o of a)"longtask"===o.entryType&&(t+=o.duration,e(at("LongTask(ms)",t,ze)))}));return n.observe({entryTypes:["longtask"]}),()=>{n.disconnect()}}(e);return()=>{cancelAnimationFrame(t),s()}}function $e(e){Qe((t=>{e.items=function(e,t){return et([e],t)}(t,e.items)}))}function et(e,t){return t.forEach((t=>{e.find((e=>t.name===e.name))||e.push(t)})),e.sort((e=>e.key===ze?-1:1)),e}async function tt(){const e=await o.getServerInfo();return{name:Re,items:e}}function nt(e){return e.totalStories.map((e=>function(e){const t=[];let n=[],a=0,o=0,s=0;const i={};return e.widgets.forEach((e=>{var c;e.refresh&&(null==(c=e.refresh)?void 0:c.open)&&t.push(e.name),n=n.concat(e.getActions().filter((e=>e.type===K.JAVASCRIPT)).map((t=>({name:e.name,jsName:t.name,code:t.body.code}))));const{displayName:l}=J.getWidgetByName(e.type);i[l]=i[l]?i[l]+1:1,r(e.type)?s+=1:"d-iframe"===e.type?o+=1:-1!==Ae.indexOf(e.type)&&(a+=1)})),{name:"".concat(e.name," Widgets Information"),items:[at("WebGL Widget Count",a),at("Iframe Widget Count",o),at("Table Widget Count",s),at("Total Widget Count",e.widgets.length),at("Widget Type Statistics",JSON.stringify(i)),at("Refresh Monitoring Widget List",JSON.stringify(t)),at("Custom JS Widget List",JSON.stringify(n))]}}(e))).concat({name:"Template Overall Information",items:[at("Canvas Adaptive Mode",e.adaptiveMode),at("Canvas Scale","".concat(e.platform.scale)),at("Canvas Size","width: ".concat(e.width,", height: ").concat(e.height)),at("Screen Resolution","width: ".concat(window.screen.width,", height: ").concat(window.screen.height)),at("Device Pixel Ratio (DPR)",window.devicePixelRatio),at("Total Widget Count",e.allWidgets.length,"WIDGET_COUNT_KEY"),at("Total Page Count",e.stories.length)]})}function at(e,t,n,a){return{name:e,value:t,key:n,suggestion:a}}function ot(e,t){var n;return null==(n=e.allWidgets.find((e=>e.id===t)))?void 0:n.name}function rt(e){return e?Math.round(e):0}function st(e){return"string"==typeof e?JSON.parse(e):e}function it(e){return JSON.stringify(e)}function ct(){return(performance||Date).now()}async function lt(e){const t=await tt(),n=Ze();$e(n);const a=nt(e),o=await wt(void 0,e);return a.concat(n).concat(t).concat(o||[])}function dt(e){const t=e.substr(e.indexOf("?")+1).split("&"),n=new Map;for(const a of t){const e=a.split("=");n.set(e[0],e[1])}return n}function mt(e,t){const n=setTimeout((()=>{e(),clearTimeout(n)}),t)}function ut(e,t="record",n=document.title){const a=it(e),o=new Blob([a],{type:"application/json"}),r=new File([o],"".concat(n,".json"),{type:"application/json"}),s=new FormData;return s.append("file",r),s.append("dir",t),Y.upload("http://localhost:3001/performance/upload",s)}function pt(e){return Y.get("http://localhost:3001/performance",{filePath:e})}function ht(e){return Y.get("http://localhost:3001/performance",{filePath:"".concat(e,"/").concat("source.json")})}class gt{constructor(e){t(this,"store",null),t(this,"appStoreInfo",{}),t(this,"instanceMap",new WeakMap),t(this,"instances",[]),t(this,"fileSizeTemp",{}),t(this,"callbackFunc",null),this.store=e}mountCalderInstance(e){var t,n;this.instanceMap.set(e,{}),this.instances.push(e),this.setupInstanceListener(e),this.ResourceBaseURL=(null==(t=window.Calder)?void 0:t.ResourceBaseURL)||(null==(n=window.CalderCustom)?void 0:n.ResourceBaseURL)}mountCalderApp(e){this.calderAppStore!==e&&(this.calderAppStore=e,this.setupAppListener(),this.ResourceBaseURL=(window.calderApp||window.calderCustomApp).ResourceBaseURL)}setupAppListener(){const{eventCenter:e}=this.calderAppStore;this._attachCalderEventListeners(e,this.appStoreInfo,(()=>{this.logAppInfo()}))}setupInstanceListener(e){const t=this.instanceMap.get(e);this._attachCalderEventListeners(e,t,(async()=>{this.callbackFunc&&this.callbackFunc(await Promise.all(this.logInstanceInfo()))}))}_attachCalderEventListeners(e,t,n){e.on("sceneUpdateStart",(()=>{t.startTime=Date.now()})),setTimeout((()=>{e.on("sceneUpdateEnd",(()=>{t.endTime=Date.now(),n()}))}),100),e.on("modelUpdateStart",(()=>{t.modelUpdateStartTime=Date.now()})),e.on("modelUpdateEnd",(()=>{t.modelUpdateEndTime=Date.now()})),e.on("modelLoadStart",(()=>{t.modelLoadStartTime=Date.now()})),e.on("modelLoadEnd",(()=>{t.modelLoadEndTime=Date.now()}))}async logAppInfo(){const{scene:e}=this.calderAppStore.render,{calderModel:t}=this.calderAppStore,n=this.appStoreInfo;n.isCalderCity="calder/CalderModel"===t.$modelType;const a=n.isCalderCity?t.customMeshModels:t.nodes.filter((e=>!!e.url));n.size=await this._getAddMeshesTotalSize(a),n.totalMeshCount=e.meshes.length.toString(),n.userAddMeshCount=a.length,n.activeMeshCount=e.getActiveMeshes().length,n.activeFaceCount=e.getActiveIndices()/3,n.isCalderCity&&(Object.assign(n,this._getSceneGeoMeshesInfo(e)),n.geojsonSize=await this._getGeojsonSize(this.calderAppStore.calderModel.geojsonId)),this._showDetailInfos(n)}logInstanceInfo(){return this.instances.map((async e=>{var t;const n=this.instanceMap.get(e);n.widgetID=null==(t=e._options)?void 0:t.name,n.widgetID&&(n.widgetID=n.widgetID.replace(".json","")),n.isCalderCity="undefined"!=typeof Calder&&e instanceof Calder;const{scene:a}=e.view.render,o=e.getOptions(),r=n.isCalderCity?o.customMeshModels:o.nodes.filter((e=>!!e.url));return n.size=await this._getAddMeshesTotalSize(r),n.totalMeshCount=a.meshes.length.toString(),n.userAddMeshCount=r.length,n.activeMeshCount=a.getActiveMeshes().length,n.activeFaceCount=a.getActiveIndices()/3,n.isCalderCity&&(Object.assign(n,this._getSceneGeoMeshesInfo(a)),n.geojsonSize=await this._getGeojsonSize(o.geo.geojsonId)),this._showDetailInfos(n)}))}async _getAddMeshesTotalSize(e){const t=new Set;e.forEach((e=>t.add(e.url))),await Promise.all(Array.from(t).map((async e=>{await this.checkAndRecordFileSize(e)})));let n=0;return e.forEach((e=>{n+=this.fileSizeTemp[e.url]})),n}async _getGeojsonSize(e){const t="/geo/".concat(e,".geojson");return await this.checkAndRecordFileSize(t),this.fileSizeTemp[t]}_getSceneGeoMeshesInfo(e){return{buildingMeshCount:e.getNodeByID("buildingGroup").getChildMeshes(!1).length,roadMeshCount:e.getNodeByID("roadGroup").getChildMeshes(!1).length}}_showDetailInfos(e){const t=e.isCalderCity?[at("Component Type","Calder City"),at("GeoJSON Size (MB)",e.geojsonSize.toFixed(2)),at("Buildings",e.buildingMeshCount),at("Roads",e.roadMeshCount)]:[at("Component Type","Calder Custom")];return{name:"Page Name: ".concat((n=this.store,a=e.widgetID,null==(o=n.totalStories.find((e=>e.getWidgetById(a))))?void 0:o.name)," Component Name: ").concat(ot(this.store,e.widgetID)),items:t.concat([at("Total Update Time (ms)",this._dealTime(e.endTime-e.startTime),"calderUpdate_KEY"),at("Custom Model Total Update Time (ms)",this._dealTime(e.modelUpdateEndTime-e.modelUpdateStartTime),"modelUpdateDuration_KEY"),at("Custom Model Total Load Time (ms)",this._dealTime(e.modelLoadEndTime-e.modelLoadStartTime),"modelLoadDuration_KEY"),at("Total Imported Model Size in Scene (MB)",e.size.toFixed(2)),at("Total Models in Scene",e.totalMeshCount),at("User-Added Models (Root Models)",e.userAddMeshCount),at("Active Meshes",e.activeMeshCount),at("Active Faces",e.activeFaceCount)])};var n,a,o}_dealTime(e){return isNaN(e)?"NaN, see the user manual.":e}async checkAndRecordFileSize(e){if(this.fileSizeTemp[e])return;const t=this.ResourceBaseURL+e,n=e.split("/").pop(),a=await fetch(t),o=await a.blob(),r=new File([o],n).size/1024/1024;return this.fileSizeTemp[e]=r,r}}function ft(e){return!window.__CALDER_INSPECTOR&&(window.__CALDER_INSPECTOR=new gt(e),!0)}async function wt(e,t){if(ft(t)||!window.__CALDER_INSPECTOR.callbackFunc){const n=function(e){return s(e.totalStories.map((t=>t.widgets.filter((e=>i(e.type))).map((t=>{var n;return null==(n=e.duchampServer.widgetInstanceManager.get(t.id))?void 0:n.calder})))))}(t);if(n&&n.length)return 0===window.__CALDER_INSPECTOR.instances.length&&n.forEach((e=>e&&window.__CALDER_INSPECTOR.mountCalderInstance(e))),window.__CALDER_INSPECTOR.callbackFunc=e,await Promise.all(window.__CALDER_INSPECTOR.logInstanceInfo())}return[]}const vt=3e5,yt=39e5,Ct=42e5;function St(e,t){switch(t){case"record_all":!async function(){const e=st(await pt("".concat(We,"/").concat(Fe)));for(const t of e)await bt(t);window.close()}();break;case Ue:ft(e),function(e){const t=decodeURIComponent(dt(window.location.href).get(Be)||"");!function(e,t){mt((()=>{lt(e).then((e=>{ut(e,"".concat(t,"/").concat(Ge))}))}),vt),mt((()=>{window.gc&&window.gc(),lt(e).then((e=>{ut(e,"".concat(t,"/").concat(He)).then((e=>window.close()))}))}),yt)}(e,"".concat(Ve,"/").concat(t))}(e);break;case"compare_with_standard":!async function(){Et(!0)}();break;case"compare_with_start":!async function(){Et(!1)}();break;case"monitor_calder_from_begin":ft(e)}}async function bt(e){const t=st(await ht("".concat(We,"/").concat(e))),{items:n}=t,a=Math.ceil(n.length/6);for(let o=0;o<a;o++)mt((()=>{_t(o,t,e)}),o*Ct);return new Promise((e=>{mt(e,a*Ct)}))}function _t(e,t,n){const{baseUrl:a,items:o}=t,r=window.screen.height/2,s=window.screen.width/3;let i=0,c=0;for(let l=0;l<6;l++){const t=6*e+l;if(t>=o.length)break;const d=o[t],m="".concat(a).concat(encodeURIComponent(d.path),"&").concat(je,"=").concat(Ue,"&").concat(Be,"=").concat(n);window.open(m,"_blank","location=no,noopener=yes,noreferrer=yes,width=".concat(s-10,",height=").concat(r-10,",top=").concat(i,",left=").concat(c)),l%3==2?(c=0,i+=r):c+=s}}async function Et(e){const t=st(await pt("".concat(We,"/").concat(Fe)));for(const n of t)await It(n,e)}async function It(e,t){const n=st(await ht("".concat(We,"/").concat(e))),{items:a}=n,o=new Map,r=t?"".concat("standard","/").concat(e,"/").concat(He):"".concat(Ve,"/").concat(e,"/").concat(Ge),s="".concat(Ve,"/").concat(e,"/").concat(He);for(const c of a)try{const t=st(await pt("".concat(r,"/").concat(c.name,".json"))),n=Tt(t,st(await pt("".concat(s,"/").concat(c.name,".json"))));ut(n,"".concat("compareResult","/").concat(e),c.name),n.forEach((e=>{var t;const n=e.key;o.has(n)||o.set(n,{key:n,items:[]}),null==(t=o.get(n))||t.items.push({tplName:c.name,widgetCount:c.widgetCount,compareResultItem:e})}))}catch(i){console.error("sceneName: ".concat(e,", tpl name: ").concat(c.name))}o.forEach((e=>e.items.sort(((e,t)=>t.compareResultItem.percent-e.compareResultItem.percent)))),ut(Array.from(o.values()),"".concat("analyse","/").concat(e),"report")}function Tt(e,t){const n=[];return e.forEach((e=>{const a=t.find((t=>t.name===e.name));a&&function(e,t,n,a){e.forEach((e=>{if(e.key){const o=t.find((t=>t.key===e.key));o&&n.push({percent:0===o.value?e.value:o.value/e.value,state:Nt(e.key,e.value,o.value),lastData:e.value,currentData:o.value,key:kt(a,e.key),name:e.name})}}))}(e.items,a.items,n,e.name)})),n}function kt(e,t){return e&&e!==Pe?"".concat(e,".").concat(t):t}function Mt(e){return-1!==Oe.indexOf(e)}function Nt(e,t,n){return n/t>1.1?Mt(e)?"improve":"error":n/t<.9?Mt(e)?"error":"improve":"normal"}const Lt=({errorMsg:e,solution:t})=>c(d,{children:[l("div",{className:"error-image",style:{backgroundImage:"url(".concat(fe("/assets/system/preview_error.png"),")")}}),l("div",{className:"error-tip",children:e||duchampIntl.get("Duchamp-Reuse_Template_Preview_Fail")}),l("div",{className:"error-solution-tip",children:t||duchampIntl.get("Duchamp-Error_Unknown")})]}),xt=p((({errorInfo:e})=>{const{errorCode:t,exception:n,errorMsg:a,solution:o}=e,{handleCopy:r}=X(e);return(()=>{const e=q();m((()=>{e.eventEmitter.emit(u.VIEW_LOADED)}))})(),c("div",{id:"preview-error",className:h(g,"preview-error-container"),children:[l(Lt,{errorMsg:a,solution:o}),l(Z,{errorCode:t,exception:n}),l(f,{type:"primary",className:"error-view-content-copy",onClick:r,children:duchampIntl.get("Duchamp-Copy_Error_Message")})]})}));function At(e){return e&&e.map?l(d,{children:e.map(((e,t)=>l("p",{children:"".concat(e.name,":    ").concat(e.value)},t)))}):l("div",{})}function Rt(e){return e.widgetFontMap?l(w,{defaultActiveKey:[],ghost:!0,contentPadding:"8px 16px",color:"#fff",items:e.stories.map(((t,n)=>({key:n,label:t.name,style:{background:"transparent"},children:l(d,{children:t.widgets.map((t=>{const n=e.widgetFontMap.get(t.id);return c("p",{children:[t.name," : ",null==n?void 0:n.join(", ")]},t.id)}))})})))}):l(d,{})}function Pt(e){return e.groups?l(w,{defaultActiveKey:[],ghost:!0,contentPadding:"8px 16px",color:"#fff",items:e.groups.map(((e,t)=>({key:t,label:e.name,children:At(e.items),style:{background:"transparent"}})))}):l(d,{})}const Dt={error:4e4,improve:2e4,normal:0};function zt(e){if(!e||!e.items)return l("div",{});const t=[Ot("name"),Ot("lastData"),Ot("currentData"),Ot("percent current/last"),Ot("state",{defaultSortOrder:"descend",sorter:(e,t)=>Dt[e.state]+e.percent-(Dt[t.state]+t.percent)})],n=e.items.map(((e,t)=>({...e,key:t})));return l(ve,{className:"compare-table",columns:t,dataSource:n,pagination:!1,size:"large",hasBorder:!0},"widgets")}function Ot(e,t={}){return{...t,title:e,dataIndex:e,key:e}}function jt(){const[e,t]=a.useState("");return c(d,{children:[l(v.Search,{placeholder:"Enter request URL keywords to search related request information, supports fuzzy search. Example: 123.glb",onSearch:e=>{const n=function(e){if(e&&window.performance)return window.performance.getEntries().find((t=>t instanceof PerformanceResourceTiming&&-1!==t.name.indexOf(e)))}(e);t(JSON.stringify(n))},enterButton:!0}),l("p",{children:e})]})}class Bt extends a.Component{constructor(e){super(e),t(this,"timer"),this.state={name:Pe,items:[]}}componentDidMount(){this._updateItems(Ze().items),this.timer=Qe(this._update.bind(this))}componentWillUnmount(){this.timer&&this.timer()}_update(e){this._updateItems([e])}_updateItems(e){this.setState((t=>(et(e,t.items),{items:e}))),this.props.updateFunc(this.state)}render(){return c("div",{children:[At(this.state.items),l(jt,{})]})}}let Ut,Wt=[],Ft=[];const Gt="Built-in Fonts Used by Tables and Charts",Ht={background:"transparent"},Vt=p((e=>{const t=q(),[n,o]=a.useState(),r=a.useCallback((e=>{var t,n;n=Ft,Ft=(t=e).concat(n.filter((e=>!t.find((t=>t.name===e.name)))))}),[]);a.useMemo((()=>{wt(r,t).then((e=>{e.length&&!Ft.length&&(Ft=e),Wt=nt(t),tt().then(o)}))}),[]);const s=a.useCallback((e=>{Ut=e}),[]),i=a.useMemo((()=>{var e,t;const a=new Map;return null==(t=null==(e=null==n?void 0:n.items)?void 0:e.find((e=>e.name===Gt)))||t.value.forEach((e=>{a.set(e.widgetId,e.fonts)})),a}),[n]);return c("div",{style:{userSelect:"text"},children:[c(be,{size:8,children:[l(y,{showUploadList:!1,accept:".json",beforeUpload:t=>{const n=new FileReader;return n.readAsText(t),n.onload=()=>{const t=st(n.result);e.setCompareInfo(Tt(t,Wt.concat(Ft||[]).concat(Ut))),e.setCompareShow(!0)},!1},children:l(f,{type:"primary",id:"uploadID",children:"Upload"})}),l(f,{type:"primary",onClick:()=>{const e=it(Wt.concat(Ft||[]).concat(Ut).concat(n?[n]:[])),t=new Blob([e],{type:"application/json"}),a=URL.createObjectURL(t),o=document.createElement("a");o.href=a,o.download="".concat(document.title,".json"),o.click(),URL.revokeObjectURL(a)},children:"Export"})]}),l(w,{defaultActiveKey:["1","2","3"],ghost:!0,contentPadding:"8px 16px",color:"#fff",items:[{key:"1",label:Pe,children:c(d,{children:[l(Bt,{updateFunc:s}),l(C,{dashed:!0,className:"divider"})]}),style:Ht},{key:"2",label:"Template Info",children:c(d,{children:[l(Pt,{groups:Wt}),l(C,{dashed:!0,className:"divider"})]}),style:Ht},{key:"3",label:"3D Info",children:l(Pt,{groups:Ft}),style:Ht},{key:"4",label:Re,children:n?At(n.items.filter((e=>e.name!==Gt))):l("div",{}),style:Ht},{key:"5",label:Gt,children:l(Rt,{widgetFontMap:i,stories:t.stories}),style:Ht}]})]})}));let Kt=-1;const Jt={styles:{body:{overflowY:"scroll"}},style:{background:"black",color:"white"}},Yt=()=>{const[e,t]=a.useState(!1),[n,o]=a.useState(!1),[r,s]=a.useState();ye("mod+j+k, shift+j+k",(e=>{e.preventDefault(),Kt++,Kt>0&&t(!0)}));return e?c(d,{children:[l(S,{...Jt,placement:"left",width:"50%",mask:!0,autoClose:!0,className:"performance-pane",title:"Performance",onClose:()=>{t(!1)},visible:e,children:l(Vt,{setCompareInfo:s,setCompareShow:o})}),l(S,{...Jt,width:"50%",mask:!0,autoClose:!0,className:"performance-pane",title:"Compare",onClose:()=>{o(!1)},visible:n,children:r?l(zt,{items:r}):l("div",{})})]}):l(d,{})},qt=p((()=>{const{actionMenuManager:e}=q();return l(E,{id:b.EVENT_ACTION,className:"action-context-menu duchamp-context-menu",animation:"",children:e.eventPicks.map((t=>l(_,{onClick:()=>e.executeEvent(t),children:l("div",{title:t.name,className:"ellipsis-text",children:t.name})},t.id)))})})),Xt=p((()=>{const e=q(),{currentPreviewStoryIndex:t,previewStories:n}=e,[o,r]=a.useState(0),[s,i]=a.useState(new Array(5).fill(!1));return a.useEffect((()=>{const e=(t+1)/n.length*168;r(e);const a=Math.floor(e/42);i((e=>e.map(((e,t)=>t<=a))))}),[t,n.length]),c("div",{className:"export-slider",children:[c("div",{className:"progress-container",children:[l(I,{className:"export-background-icon",src:fe("/assets/widget/icon-export-bar.svg")}),l("div",{children:s.map(((e,t)=>l("div",{className:"dot ".concat(e||0===t?"visible":"invisible")},t)))}),l("div",{className:"progress-bar",style:{width:"".concat(o,"px")}})]}),l("div",{className:"export-text",children:duchampIntl.get("Duchamp-Exporting_Presentation_Tip",t+1,n.length)})]})})),Zt=p((()=>{const e=q(),{isExporting:t}=e;return l("div",{children:l(T,{className:"export-mask",classNames:{wrapper:"export-mask-wrapper",body:"export-mask-body"},contentPadding:!1,closable:!1,styles:{mask:{backgroundColor:"rgba(0, 0, 0, 0.65)"}},visible:t,text4Ok:null,text4Cancel:null,destroyOnClose:!0,width:600,height:32,children:l(Xt,{})})})})),Qt=p((({visible:e,onCancel:t,onOk:n})=>{const a=q(),{portalRef:o}=Q(),{cancelHandler:r,okHandler:s}=$({visible:e,onCancel:t,onOk:n});return(null==o?void 0:o.current)?l(S,{visible:e,className:h("controller-panel-drawer",a.duchampServer.themeManager.theme),title:duchampIntl.get("Duchamp-Controller_Panel"),width:400,autoClose:!0,mask:!0,placement:"left",closeIcon:l("div",{className:"controller-panel-drawer-icon",children:l(k,{svgContent:Te})}),onClose:r,classNames:{header:"controller-panel-drawer panel-header",footer:"controller-panel-drawer panel-footer"},container:o.current,footer:l(M,{justify:"end",children:c(be,{size:"small",children:[l(f,{onClick:r,className:"fvs-controller-button",children:duchampIntl.get("Duchamp-Cancel")}),l(f,{type:"primary",onClick:s,className:"fvs-controller-button-primary",children:duchampIntl.get("Duchamp-Query")})]})}),children:l("div",{className:"controller-panel-drawer-content",children:a.queryPanelDisplayedWidgets.map((e=>l(ee,{widget:e,width:368},e.id)))})}):null})),$t=a.forwardRef((({text:e},t)=>l("span",{ref:t,className:"navigation-menu-item-wrapper",children:l(N.Text,{className:"navigation-menu-item-text",ellipsis:{tooltip:{content:e,placement:"right",offset:[24,-4],color:"rgba(0, 0, 0, 65%)",style:{maxWidth:"250px"}}},children:e})})));$t.displayName="MenuItem";const en=p($t),tn=p((e=>{const t=q(),n=a.useRef([]),{target:o}=e,r=()=>{var e;null==(e=n.current[t.currentPreviewStoryIndex])||e.scrollIntoView({behavior:"smooth",block:"nearest"})};return r(),l(L,{menu:{className:"navigation-menu",style:{padding:0},items:t.previewStories.map(((e,a)=>({key:"".concat(a),className:h("navigation-menu-item",{selected:t.currentPreviewStoryIndex===a}),onClick:()=>{t.previewSwitchStory(a)},content:l(en,{ref:e=>{n.current[a]=e},text:duchampIntl.get("Duchamp-Story_Navigation",a+1,e.name)})})))},overlayClassName:"navigation-dropdown",className:"navigation-wrapper",placement:"top-left",getPopupContainer:()=>o.current||document.body,trigger:"hover",onVisibleChange:e=>{e&&setTimeout(r,300)},children:l(k,{svgContent:Ne,type:"icon-navigation",className:"clickable"})})})),nn=p((()=>{const e=q(),{previewConfig:t,controllerPanel:n,isControllerPanelEnabled:o,queryPanelDisplayedWidgets:r,hasLinkage:s,showParametersPanel:i}=e,m=a.useRef(null),{hasPagination:u,canPre:p,canNext:g}=(({allowAuto:e,allowHover:t=!0})=>{const n=q(),{previewConfig:o}=n,r=n.previewStories.length>1&&(t?"never"!==o.pageButtonDisplayPolicy:"always"===o.pageButtonDisplayPolicy),s=o.loop||n.currentPreviewStoryIndex>0,i=o.loop||n.currentPreviewStoryIndex<n.previewStories.length-1,c=e&&n.isPlay&&o.autoplay&&n.previewStories.length>1&&i;return a.useEffect((()=>{const e=c?setTimeout((()=>n.previewNextStory()),1e3*o.autoplaySpeed):null;return()=>{e&&clearTimeout(e)}}),[c,o.autoplaySpeed,n,n.mainStory]),{current:n.currentPreviewStoryIndex+1,total:n.previewStories.length,hasPagination:r,canPre:s,canNext:i,canAutoChange:c}})({allowAuto:!0}),[f,w]=x(null!=i?i:o&&!n.autoSearch,[n.autoSearch,i,o]),v=()=>{w(!1)};return c("div",{className:"story-navigation",children:[o&&c(d,{children:[r.length>0&&l(k,{svgContent:ke,type:"icon-filterLarge",onClick:()=>{e.setIsPlay(!1),w(!0)}}),l(Qt,{visible:f&&e.isControllerPanelInitialized,onOk:v,onCancel:v})]}),s&&l(k,{svgContent:Ie,type:"icon-cancel-linkage",onClick:()=>e.clearAllLinkage()}),u&&c("div",{ref:m,className:h("story-pagination",{"auto-hide":"hover"===t.pageButtonDisplayPolicy}),children:[l(k,{disabled:!p,type:"icon-last-page",svgContent:Me,onClick:()=>e.previewPreviousStory()}),t.autoplay&&l(k,{svgContent:e.isPlay?xe:te,type:e.isPlay?"icon-pause":"icon-play",onClick:()=>{e.setIsPlay(!e.isPlay)}}),l(k,{disabled:!g,type:"icon-next-page",svgContent:Le,onClick:()=>e.previewNextStory()}),l(tn,{target:m})]})]})})),an=p((({templateTheme:e={}})=>{const t=q(),n=a.useRef(null),o=a.useRef(null),{currentPreviewStoryIndex:r}=t;(()=>{const e=q();ye("left",(()=>e.previewPreviousStory())),ye("right",(()=>e.previewNextStory())),ye("space",(()=>{e.setIsPlay(!e.isPlay)}))})();const s=a.useRef(null);return(()=>{const e=q();e.dataLoaded&&performance&&(performance.clearMarks("whiteScreen"),performance.mark("whiteScreen")),a.useEffect((()=>{e.dataLoaded&&e.eventEmitter.emit(u.VIEW_LOADED)}),[e.dataLoaded]),A((()=>{let t=[];e.previewStories.forEach((e=>{const n=e.platform.backgroundLayer;t=t.concat(ne(n.resource)?n.resource.preload(n.value):[])})),R(P(t.map((t=>we(t,e.duchampServer.resourceBaseUrl)))))}),[e.previewStories.length])})(),Ce({ref:s,watermarkData:t.watermarkData}),Se({target:t.target,withLic:t.withLic}),Ee(s),l(re,{refs:{portalRef:n,zoomRef:o},children:l(ae.Provider,{initialState:{token:t.themeToken,prefixKey:oe,...e},children:c("div",{ref:s,id:"preview",className:h(g,D.MAIN,t.duchampServer.themeManager.theme,e.dynamicStyleClassName),"data-story":r,children:[l(_e,{layoutType:z.RESERVE}),l(nn,{}),l(Yt,{}),l(qt,{}),l(Zt,{}),l("div",{ref:n,className:D.PORTAL}),l("div",{ref:o,className:D.ZOOM})]})})})})),on=a.forwardRef((({language:e="zh_CN",store:t,theme:n,templateTheme:o},r)=>(a.useImperativeHandle(r,(()=>({getStore:()=>t}))),t?l(se.Provider,{value:t,children:l(O,{locale:j(e),styleContainer:document.body,theme:n,children:l(B,{locale:e,fetchInfo:U(t),children:l(rn,{templateTheme:o})})})}):null)));on.displayName="FVSPreview";const rn=p((({templateTheme:e={}})=>{const t=q();return t.errorInfo?l(xt,{errorInfo:t.errorInfo}):l(an,{templateTheme:e})})),sn=de("preview");window.duchampInit=(e={el:document.getElementById("root"),data:V()})=>{var t,n,r,s;null==(n=(t=window.performance).mark)||n.call(t,me.DUCHAMP_INIT);const i=G(e);H(i),ue(),document.documentElement.classList.add(pe((null==(s=null==(r=i.data.store)?void 0:r.styleConfig)?void 0:s.theme)||he.LIGHT)),(({el:e,data:t,error:n,language:o="zh_CN",theme:r,templateTheme:s},i)=>{var c;const d=ie("preview");null==(c=i.beforeInit)||c.call(i,d),ce({store:d,data:t,error:n,el:e}).then((e=>{var t;null==(t=i.afterInit)||t.call(i,e)}));const m=W(e);m.render(l(a.StrictMode,{children:l(on,{language:o,store:d,theme:r,templateTheme:s})})),le(d,{destroy:()=>{m.unmount(),F(d)}})})(i,{beforeInit:e=>{sn.setStore(e),e.duchampServer.setDuchamp(sn),e.duchampServer.setEnvInfo(o.getEnvInfo()),sn.on(u.PAGE_LOADED,(function(){window.Ops&&window.Ops.recordPerfData(performance.now())})),sn.on(u.VIEW_LOADED,(()=>{window.document.body.classList.remove("init-loading"),window.closeTemplateLoad&&window.closeTemplateLoad()}))},afterInit:e=>{St(e,dt(window.location.href).get(je))}})},ge.reportWebVitals();export{n as __vite_legacy_guard};
