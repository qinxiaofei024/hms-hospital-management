<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ‰‹æœ¯è´¨é‡å®‰å…¨ç›‘æµ‹ - åŒ»ç–—è´¨é‡å®‰å…¨ç›‘æµ‹ç³»ç»Ÿ</title>
    <link rel="stylesheet" href="../css/style.css">
    <link rel="stylesheet" href="../css/medical-quality-safety.css">
    <script src="../js/common.js"></script>
    <script src="../js/navigation-loader.js?v=20250125-fix3"></script>
    <script src="../js/medical-quality-components.js"></script>
    <script src="../js/medical-charts.js"></script>
    <script src="../js/medical-data-simulator.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>
    <style>
        /* æ‰‹æœ¯è´¨é‡å®‰å…¨ç›‘æµ‹é¡µé¢ä¸“ç”¨æ ·å¼ */
        .surgical-container {
            padding: 20px;
            background-color: #f5f7fa;
            min-height: calc(100vh - 48px);
        }

        .page-header {
            margin-bottom: 24px;
            padding: 0;
            background: transparent;
            border-radius: 0;
            box-shadow: none;
        }

        .page-header h2 {
            color: #333;
            font-size: 24px;
            margin: 0 0 8px 0;
            font-weight: 600;
        }

        .page-header .english-title {
            color: #666;
            font-size: 14px;
            font-weight: 400;
            margin-left: 8px;
        }

        .breadcrumb {
            margin-bottom: 20px;
            color: #666;
            font-size: 14px;
        }

        .breadcrumb-list {
            display: flex;
            list-style: none;
            padding: 0;
            margin: 0;
            background: white;
            padding: 12px 20px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .breadcrumb-item {
            color: #6c757d;
            font-size: 0.9rem;
        }

        .breadcrumb-item:last-child {
            color: #495057;
            font-weight: 500;
        }

        .breadcrumb-separator {
            margin: 0 10px;
            color: #dee2e6;
        }

        /* å®æ—¶ç›‘æ§é¢æ¿ */
        .real-time-panel {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .real-time-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #e9ecef;
        }

        .real-time-title {
            color: #333;
            font-size: 18px;
            font-weight: 600;
            margin: 0;
        }

        .real-time-status {
            display: flex;
            align-items: center;
            color: #28a745;
            font-size: 14px;
        }

        .status-indicator {
            width: 8px;
            height: 8px;
            background: #28a745;
            border-radius: 50%;
            margin-right: 8px;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }

        .real-time-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .real-time-card {
            background: white;
            color: #333;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            border-left: 4px solid #0078d4;
            transition: transform 0.3s ease;
        }

        .real-time-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }

        .real-time-card.surgery {
            border-left-color: #0078d4;
        }

        .real-time-card.completed {
            border-left-color: #28a745;
        }

        .real-time-card.risk {
            border-left-color: #ffc107;
        }

        .real-time-card.emergency {
            border-left-color: #dc3545;
        }

        .real-time-value {
            font-size: 28px;
            font-weight: bold;
            margin-bottom: 8px;
            color: #0078d4;
        }

        .real-time-card.completed .real-time-value {
            color: #28a745;
        }

        .real-time-card.risk .real-time-value {
            color: #ffc107;
        }

        .real-time-card.emergency .real-time-value {
            color: #dc3545;
        }

        .real-time-label {
            font-size: 14px;
            color: #666;
        }

        /* ç»Ÿè®¡å¡ç‰‡ */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            cursor: pointer;
            border-left: 4px solid #0078d4;
        }

        .stat-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }

        .stat-card.excellent {
            border-left-color: #28a745;
        }

        .stat-card.good {
            border-left-color: #0078d4;
        }

        .stat-card.warning {
            border-left-color: #ffc107;
        }

        .stat-card.danger {
            border-left-color: #dc3545;
        }

        .stat-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 15px;
        }

        .stat-title {
            font-size: 14px;
            color: #666;
            font-weight: 500;
            margin: 0;
        }

        .stat-icon {
            font-size: 20px;
            opacity: 0.7;
        }

        .stat-value {
            font-size: 28px;
            font-weight: bold;
            color: #333;
            margin: 10px 0;
        }

        .stat-change {
            font-size: 14px;
            font-weight: 500;
        }

        .stat-change.positive {
            color: #28a745;
        }

        .stat-change.negative {
            color: #dc3545;
        }

        .stat-change.stable {
            color: #6c757d;
        }

        /* ä¸»è¦å†…å®¹ç½‘æ ¼ */
        .main-grid {
            display: block;
            margin-bottom: 30px;
        }

        /* å›¾è¡¨å®¹å™¨ */
        .chart-container {
            background: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            width: 100%;
            margin-bottom: 20px;
        }

        .chart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #e9ecef;
        }

        .chart-title {
            font-size: 18px;
            font-weight: 600;
            color: #333;
            margin: 0;
        }

        .chart-controls {
            display: flex;
            gap: 8px;
        }

        .chart-control-btn {
            padding: 8px 16px;
            border: 1px solid #dee2e6;
            background: white;
            color: #666;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .chart-control-btn:hover {
            background: #f8f9fa;
            border-color: #adb5bd;
        }

        .chart-control-btn.active {
            background: #0078d4;
            color: white;
            border-color: #0078d4;
        }

        .chart-wrapper {
            height: 400px;
            width: 100%;
        }



        /* æŒ‡æ ‡ç›‘æ§åŒºåŸŸ */
        .indicators-section {
            margin-bottom: 30px;
        }

        .indicators-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
        }

        .indicator-card {
            background: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .card-title {
            font-size: 16px;
            font-weight: 600;
            color: #333;
            margin: 0 0 15px 0;
            padding-bottom: 10px;
            border-bottom: 1px solid #e9ecef;
        }

        .indicator-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .indicator-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            background: #f8f9fa;
            border-radius: 8px;
            transition: all 0.3s ease;
        }

        .indicator-item:hover {
            background: #e9ecef;
        }

        .indicator-name {
            font-size: 0.9rem;
            color: #495057;
            font-weight: 500;
        }

        .indicator-value {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .indicator-number {
            font-weight: bold;
            font-size: 0.9rem;
        }

        .indicator-number.excellent {
            color: #28a745;
        }

        .indicator-number.good {
            color: #17a2b8;
        }

        .indicator-number.warning {
            color: #ffc107;
        }

        .indicator-number.danger {
            color: #dc3545;
        }

        .indicator-trend {
            font-size: 0.8rem;
            font-weight: 500;
        }

        .indicator-trend.up {
            color: #28a745;
        }

        .indicator-trend.down {
            color: #dc3545;
        }

        .indicator-trend.stable {
            color: #6c757d;
        }

        /* é£é™©è¯„ä¼°çŸ©é˜µ */
        .risk-matrix {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 8px;
            margin-top: 15px;
        }

        .risk-cell {
            aspect-ratio: 1;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            font-weight: bold;
            color: white;
            text-align: center;
        }

        .risk-cell.low {
            background: #28a745;
        }

        .risk-cell.medium {
            background: #ffc107;
        }

        .risk-cell.high {
            background: #fd7e14;
        }

        .risk-cell.critical {
            background: #dc3545;
        }

        /* æ‰‹æœ¯æ—¶é—´çº¿ */
        .surgery-timeline {
            margin-top: 15px;
        }

        .timeline-item {
            display: flex;
            align-items: center;
            margin-bottom: 12px;
            padding: 8px;
            background: #f8f9fa;
            border-radius: 6px;
        }

        .timeline-time {
            font-size: 0.8rem;
            color: #6c757d;
            min-width: 60px;
        }

        .timeline-content {
            flex: 1;
            margin-left: 12px;
        }

        .timeline-surgery {
            font-size: 0.9rem;
            font-weight: 500;
            color: #495057;
        }

        .timeline-status {
            font-size: 0.8rem;
            color: #6c757d;
        }

        /* æ•°æ®è¡¨æ ¼ */
        .data-table {
            background: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .table-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #e9ecef;
        }

        .table-title {
            font-size: 18px;
            font-weight: 600;
            color: #333;
            margin: 0;
        }

        .table-controls {
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .search-box {
            position: relative;
        }

        .search-box input {
            padding: 8px 35px 8px 12px;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            font-size: 14px;
            width: 250px;
        }

        .search-icon {
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            color: #6c757d;
        }

        .filter-select {
            padding: 8px 12px;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            font-size: 14px;
            background: white;
            cursor: pointer;
        }

        .table-wrapper {
            overflow-x: auto;
        }

        .quality-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 14px;
        }

        .quality-table th {
            background: #f8f9fa;
            color: #333;
            font-weight: 600;
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #dee2e6;
        }

        .quality-table td {
            padding: 12px;
            border-bottom: 1px solid #dee2e6;
            color: #666;
        }

        .quality-table tbody tr {
            transition: background-color 0.3s ease;
            cursor: pointer;
        }

        .quality-table tbody tr:hover {
            background: #f8f9fa;
        }

        .quality-table tbody tr.selected {
            background: #e3f2fd;
        }

        .status-badge {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 500;
        }

        .status-badge.excellent {
            background: #d4edda;
            color: #155724;
        }

        .status-badge.good {
            background: #cce5ff;
            color: #004085;
        }

        .status-badge.warning {
            background: #fff3cd;
            color: #856404;
        }

        .status-badge.danger {
            background: #f8d7da;
            color: #721c24;
        }

        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 768px) {
            .main-grid {
                grid-template-columns: 1fr;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .real-time-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .table-controls {
                flex-direction: column;
                align-items: stretch;
                gap: 10px;
            }

            .search-box input {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <!-- ç»Ÿä¸€å¯¼èˆªç»„ä»¶ -->
    <div id="navigation-container"></div>
    
    <div class="container">
        <div class="main-content">
            <div class="content-wrapper">
                <main class="content">
                    <div class="surgical-container">
                        <!-- é¡µé¢æ ‡é¢˜ -->
                        <div id="dashboard" class="page-header">
                            <h2>æ‰‹æœ¯è´¨é‡å®‰å…¨ç›‘æµ‹ <span class="english-title">Surgical Quality and Safety Monitoring</span></h2>
                            <div class="breadcrumb">
                                <span>é¦–é¡µ</span> / <span>åŒ»ç–—è´¨é‡å®‰å…¨ç›‘æµ‹</span> / <span>æ‰‹æœ¯è´¨é‡å®‰å…¨ç›‘æµ‹</span>
                            </div>
                        </div>

                        <!-- å®æ—¶ç›‘æ§é¢æ¿ -->
                        <div class="real-time-panel">
                            <div class="real-time-header">
                                <h3 class="real-time-title">å®æ—¶æ‰‹æœ¯ç›‘æ§</h3>
                                <div class="real-time-status">
                                    <div class="status-indicator"></div>
                                    <span>ç³»ç»Ÿæ­£å¸¸è¿è¡Œ</span>
                                </div>
                            </div>
                            <div class="real-time-grid" id="realTimeGrid">
                                <!-- å®æ—¶æ•°æ®å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                            </div>
                        </div>

                        <!-- ç»Ÿè®¡å¡ç‰‡åŒºåŸŸ -->
                        <div class="stats-grid" id="statsGrid">
                            <!-- ç»Ÿè®¡å¡ç‰‡å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                        </div>

                        <!-- ä¸»è¦å†…å®¹ç½‘æ ¼ -->
                        <div class="main-grid">
                            <!-- å›¾è¡¨åŒºåŸŸ -->
                            <div class="chart-container">
                                <div class="chart-header">
                                    <h3 class="chart-title">æ‰‹æœ¯è´¨é‡å®‰å…¨è¶‹åŠ¿åˆ†æ</h3>
                                    <div class="chart-controls">
                                        <button class="chart-control-btn active" data-type="trend">è¶‹åŠ¿å›¾</button>
                                        <button class="chart-control-btn" data-type="risk">é£é™©åˆ†æ</button>
                                        <button class="chart-control-btn" data-type="comparison">ç§‘å®¤å¯¹æ¯”</button>
                                    </div>
                                </div>
                                <div class="chart-wrapper">
                                    <div id="surgicalChart" style="width: 100%; height: 100%;"></div>
                                </div>
                            </div>


                        </div>

                        <!-- æ ¸å¿ƒæŒ‡æ ‡ç›‘æ§åŒºåŸŸ -->
                        <div class="indicators-section">
                            <div class="indicators-grid">
                                <!-- æ ¸å¿ƒæŒ‡æ ‡ç›‘æµ‹ -->
                                <div class="indicator-card">
                                    <h3 class="card-title">æ ¸å¿ƒæŒ‡æ ‡ç›‘æµ‹</h3>
                                    <div class="indicator-list" id="indicatorList">
                                        <!-- æŒ‡æ ‡åˆ—è¡¨å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                                    </div>
                                </div>

                                <!-- é£é™©è¯„ä¼°çŸ©é˜µ -->
                                <div class="indicator-card">
                                    <h3 class="card-title">æ‰‹æœ¯é£é™©è¯„ä¼°</h3>
                                    <div class="risk-matrix" id="riskMatrix">
                                        <!-- é£é™©çŸ©é˜µå°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                                    </div>
                                </div>

                                <!-- æ‰‹æœ¯æ—¶é—´çº¿ -->
                                <div class="indicator-card">
                                    <h3 class="card-title">ä»Šæ—¥æ‰‹æœ¯å®‰æ’</h3>
                                    <div class="surgery-timeline" id="surgeryTimeline">
                                        <!-- æ‰‹æœ¯æ—¶é—´çº¿å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- è¯¦ç»†æ•°æ®è¡¨æ ¼ -->
                        <div class="data-table">
                            <div class="table-header">
                                <h3 class="table-title">ç§‘å®¤æ‰‹æœ¯è´¨é‡å®‰å…¨è¯¦æƒ…</h3>
                                <div class="table-controls">
                                    <div class="search-box">
                                        <input type="text" placeholder="æœç´¢ç§‘å®¤æˆ–æ‰‹æœ¯ç±»å‹..." id="searchInput">
                                        <span class="search-icon">ğŸ”</span>
                                    </div>
                                    <select class="filter-select" id="departmentFilter">
                                        <option value="all">å…¨éƒ¨ç§‘å®¤</option>
                                        <option value="surgery">å¤–ç§‘ç³»ç»Ÿ</option>
                                        <option value="orthopedics">éª¨ç§‘</option>
                                        <option value="neurosurgery">ç¥ç»å¤–ç§‘</option>
                                        <option value="cardiac">å¿ƒèƒ¸å¤–ç§‘</option>
                                    </select>
                                </div>
                            </div>
                            <div class="table-wrapper">
                                <table class="quality-table" id="qualityTable">
                                    <thead>
                                        <tr>
                                            <th>ç§‘å®¤åç§°</th>
                                            <th>æ‰‹æœ¯å®‰å…¨æ ¸æŸ¥ç‡</th>
                                            <th>æ‰‹æœ¯åˆ†çº§ç®¡ç†ç‡</th>
                                            <th>æœ¯å‰è®¨è®ºç‡</th>
                                            <th>æœ¯åæ€»ç»“ç‡</th>
                                            <th>æ„ŸæŸ“é¢„é˜²ç‡</th>
                                            <th>ç»¼åˆè¯„çº§</th>
                                        </tr>
                                    </thead>
                                    <tbody id="tableBody">
                                        <!-- è¡¨æ ¼æ•°æ®å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </main>
            </div>
        </div>
    </div>

    <script>
        // æ‰‹æœ¯è´¨é‡å®‰å…¨ç›‘æµ‹é¡µé¢æ§åˆ¶å™¨
        class SurgicalQualityMonitor {
            constructor() {
                try {
                    this.dataSimulator = typeof MedicalDataSimulator !== 'undefined' ? new MedicalDataSimulator() : null;
                } catch (error) {
                    console.warn('MedicalDataSimulatorä¸å¯ç”¨:', error);
                    this.dataSimulator = null;
                }
                this.charts = {};
                this.currentChartType = 'trend';
                this.init();
            }

            async init() {
                try {
                    // ç­‰å¾…EChartsåŠ è½½å®Œæˆ
                    await this.waitForEcharts();
                    
                    // é¦–å…ˆåˆå§‹åŒ–æ•°æ®
                    this.initializeData();
                    
                    // ç¡®ä¿æ•°æ®åˆå§‹åŒ–å®Œæˆåå†æ¸²æŸ“
                    if (this.surgicalData && this.realTimeData) {
                        this.renderRealTimePanel();
                        this.renderStatCards();
                        this.renderIndicatorList();
                        this.renderRiskMatrix();
                        this.renderSurgeryTimeline();
                        this.renderDataTable();
                        this.initializeCharts();
                        this.bindEvents();
                        this.startRealTimeUpdates();
                        
                        console.log('æ‰‹æœ¯è´¨é‡å®‰å…¨ç›‘æµ‹é¡µé¢åˆå§‹åŒ–å®Œæˆ');
                    } else {
                        console.error('æ•°æ®åˆå§‹åŒ–å¤±è´¥');
                    }
                } catch (error) {
                    console.error('æ‰‹æœ¯è´¨é‡å®‰å…¨ç›‘æµ‹é¡µé¢åˆå§‹åŒ–å¤±è´¥:', error);
                }
            }

            waitForEcharts() {
                return new Promise((resolve, reject) => {
                    if (typeof echarts !== 'undefined') {
                        resolve();
                        return;
                    }
                    
                    let attempts = 0;
                    const maxAttempts = 50; // 5ç§’è¶…æ—¶
                    const checkEcharts = () => {
                        if (typeof echarts !== 'undefined') {
                            resolve();
                        } else if (attempts >= maxAttempts) {
                            reject(new Error('EChartsåŠ è½½è¶…æ—¶'));
                        } else {
                            attempts++;
                            setTimeout(checkEcharts, 100);
                        }
                    };
                    checkEcharts();
                });
            }

            initializeData() {
                // åˆå§‹åŒ–æ‰‹æœ¯è´¨é‡æ•°æ®
                console.log('å¼€å§‹åˆå§‹åŒ–æ•°æ®...');
                console.log('dataSimulator:', this.dataSimulator);
                
                try {
                    if (this.dataSimulator && typeof this.dataSimulator.generateSurgeryData === 'function') {
                        this.surgicalData = this.dataSimulator.generateSurgeryData();
                        this.realTimeData = this.dataSimulator.getRealTimeData();
                        console.log('ä½¿ç”¨æ•°æ®ç”Ÿæˆå™¨æˆåŠŸ');
                    } else {
                        throw new Error('æ•°æ®ç”Ÿæˆå™¨ä¸å¯ç”¨');
                    }
                } catch (error) {
                    console.warn('æ•°æ®ç”Ÿæˆå™¨ä¸å¯ç”¨ï¼Œä½¿ç”¨é»˜è®¤æ•°æ®:', error);
                    // ä½¿ç”¨é»˜è®¤æ•°æ®
                    this.surgicalData = this.getDefaultSurgicalData();
                    this.realTimeData = this.getDefaultRealTimeData();
                    console.log('ä½¿ç”¨é»˜è®¤æ•°æ®æˆåŠŸ');
                }
                
                console.log('surgicalData:', this.surgicalData);
                console.log('realTimeData:', this.realTimeData);
            }

            getDefaultSurgicalData() {
                return {
                    departmentData: [
                        {
                            name: 'å¿ƒèƒ¸å¤–ç§‘',
                            safetyCheckRate: 99.8,
                            levelManagementRate: 98.5,
                            preOpDiscussionRate: 96.2,
                            postOpSummaryRate: 94.8,
                            infectionPreventionRate: 99.1,
                            rating: 'excellent',
                            ratingText: 'ä¼˜ç§€'
                        },
                        {
                            name: 'ç¥ç»å¤–ç§‘',
                            safetyCheckRate: 98.9,
                            levelManagementRate: 97.8,
                            preOpDiscussionRate: 95.5,
                            postOpSummaryRate: 93.2,
                            infectionPreventionRate: 98.7,
                            rating: 'good',
                            ratingText: 'è‰¯å¥½'
                        },
                        {
                            name: 'éª¨ç§‘',
                            safetyCheckRate: 97.5,
                            levelManagementRate: 96.3,
                            preOpDiscussionRate: 92.8,
                            postOpSummaryRate: 91.5,
                            infectionPreventionRate: 97.2,
                            rating: 'good',
                            ratingText: 'è‰¯å¥½'
                        },
                        {
                            name: 'æ™®é€šå¤–ç§‘',
                            safetyCheckRate: 96.8,
                            levelManagementRate: 95.1,
                            preOpDiscussionRate: 89.7,
                            postOpSummaryRate: 88.9,
                            infectionPreventionRate: 96.5,
                            rating: 'warning',
                            ratingText: 'è­¦å‘Š'
                        },
                        {
                            name: 'æ³Œå°¿å¤–ç§‘',
                            safetyCheckRate: 98.2,
                            levelManagementRate: 97.0,
                            preOpDiscussionRate: 94.3,
                            postOpSummaryRate: 92.7,
                            infectionPreventionRate: 98.0,
                            rating: 'good',
                            ratingText: 'è‰¯å¥½'
                        }
                    ]
                };
            }

            getDefaultRealTimeData() {
                return {
                    activeSurgeries: 8,
                    emergencyWaiting: 2,
                    completedToday: 23,
                    highRiskSurgeries: 3
                };
            }

            renderRealTimePanel() {
                const realTimeGrid = document.getElementById('realTimeGrid');
                if (!realTimeGrid) {
                    console.error('realTimeGridå…ƒç´ æœªæ‰¾åˆ°');
                    return;
                }
                
                const realTimeCards = [
                    { label: 'è¿›è¡Œä¸­æ‰‹æœ¯', value: this.realTimeData.activeSurgeries || 0, type: 'surgery' },
                    { label: 'ä»Šæ—¥å®Œæˆ', value: Math.floor(Math.random() * 20) + 15, type: 'completed' },
                    { label: 'é«˜é£é™©æ‰‹æœ¯', value: Math.floor(this.realTimeData.activeSurgeries * 0.3) || 2, type: 'risk' },
                    { label: 'æ€¥è¯Šæ‰‹æœ¯', value: this.realTimeData.emergencyWaiting || 0, type: 'emergency' }
                ];

                realTimeGrid.innerHTML = realTimeCards.map(card => `
                    <div class="real-time-card ${card.type}">
                        <div class="real-time-value">${card.value}</div>
                        <div class="real-time-label">${card.label}</div>
                    </div>
                `).join('');
            }

            renderStatCards() {
                const statsGrid = document.getElementById('statsGrid');
                if (!statsGrid) {
                    console.error('statsGridå…ƒç´ æœªæ‰¾åˆ°');
                    return;
                }
                
                const stats = [
                    {
                        title: 'æ‰‹æœ¯å®‰å…¨æ ¸æŸ¥æ‰§è¡Œç‡',
                        value: '99.8%',
                        change: 'â†‘ 0.3% è¾ƒä¸Šæœˆ',
                        type: 'excellent',
                        icon: 'âœ…'
                    },
                    {
                        title: 'æ‰‹æœ¯åˆ†çº§ç®¡ç†æ‰§è¡Œç‡',
                        value: '97.5%',
                        change: 'â†‘ 1.2% è¾ƒä¸Šæœˆ',
                        type: 'good',
                        icon: 'ğŸ“Š'
                    },
                    {
                        title: 'æœ¯å‰è®¨è®ºæ‰§è¡Œç‡',
                        value: '92.3%',
                        change: 'â†“ 0.5% è¾ƒä¸Šæœˆ',
                        type: 'warning',
                        icon: 'ğŸ’¬'
                    },
                    {
                        title: 'æ­»äº¡ç—…ä¾‹è®¨è®ºæ‰§è¡Œç‡',
                        value: '88.9%',
                        change: 'â†“ 2.1% è¾ƒä¸Šæœˆ',
                        type: 'danger',
                        icon: 'âš ï¸'
                    }
                ];

                statsGrid.innerHTML = stats.map(stat => `
                    <div class="stat-card ${stat.type}" data-metric="${stat.title}">
                        <div class="stat-header">
                            <div class="stat-title">${stat.title}</div>
                            <div class="stat-icon">${stat.icon}</div>
                        </div>
                        <div class="stat-value">${stat.value}</div>
                        <div class="stat-change ${stat.change.includes('â†‘') ? 'positive' : 'negative'}">${stat.change}</div>
                    </div>
                `).join('');
            }

            renderIndicatorList() {
                const indicatorList = document.getElementById('indicatorList');
                const indicators = [
                    { name: 'æ‰‹æœ¯å®‰å…¨æ ¸æŸ¥æ‰§è¡Œç‡', current: 99.8, target: 100, trend: 'up' },
                    { name: 'æ‰‹æœ¯å¹¶å‘ç—‡å‘ç”Ÿç‡', current: 1.2, target: 2.0, trend: 'down' },
                    { name: 'æ‰‹æœ¯æ„ŸæŸ“ç‡', current: 0.8, target: 1.5, trend: 'stable' },
                    { name: 'æ‰‹æœ¯æ­»äº¡ç‡', current: 0.3, target: 0.5, trend: 'down' },
                    { name: 'æœ¯å‰å‡†å¤‡å®Œæˆç‡', current: 98.5, target: 95, trend: 'up' }
                ];

                indicatorList.innerHTML = indicators.map(indicator => `
                    <div class="indicator-item" data-indicator="${indicator.name}">
                        <div class="indicator-name">${indicator.name}</div>
                        <div class="indicator-value">
                            <span class="indicator-number ${this.getIndicatorStatus(indicator.current, indicator.target)}">${indicator.current}%</span>
                            <span class="indicator-trend ${indicator.trend}">${this.getTrendIcon(indicator.trend)}</span>
                        </div>
                    </div>
                `).join('');
            }

            renderRiskMatrix() {
                const riskMatrix = document.getElementById('riskMatrix');
                const riskLevels = ['ä½é£é™©', 'ä¸­é£é™©', 'é«˜é£é™©', 'æé«˜é£é™©'];
                const riskTypes = ['low', 'medium', 'high', 'critical'];
                const riskCounts = [45, 23, 8, 2]; // æ¨¡æ‹Ÿæ•°æ®

                riskMatrix.innerHTML = riskLevels.map((level, index) => `
                    <div class="risk-cell ${riskTypes[index]}" title="${level}: ${riskCounts[index]}å°">
                        ${level}<br>${riskCounts[index]}å°
                    </div>
                `).join('');
            }

            renderSurgeryTimeline() {
                const surgeryTimeline = document.getElementById('surgeryTimeline');
                const surgeries = [
                    { time: '08:00', surgery: 'å¿ƒè„æ­æ¡¥æ‰‹æœ¯', status: 'è¿›è¡Œä¸­', room: 'æ‰‹æœ¯å®¤1' },
                    { time: '09:30', surgery: 'è„‘è‚¿ç˜¤åˆ‡é™¤', status: 'å‡†å¤‡ä¸­', room: 'æ‰‹æœ¯å®¤3' },
                    { time: '10:00', surgery: 'éª¨æŠ˜å†…å›ºå®š', status: 'å·²å®Œæˆ', room: 'æ‰‹æœ¯å®¤2' },
                    { time: '14:00', surgery: 'èƒ†å›Šåˆ‡é™¤', status: 'è®¡åˆ’ä¸­', room: 'æ‰‹æœ¯å®¤4' },
                    { time: '15:30', surgery: 'é˜‘å°¾åˆ‡é™¤', status: 'è®¡åˆ’ä¸­', room: 'æ‰‹æœ¯å®¤5' }
                ];

                surgeryTimeline.innerHTML = surgeries.map(surgery => `
                    <div class="timeline-item">
                        <div class="timeline-time">${surgery.time}</div>
                        <div class="timeline-content">
                            <div class="timeline-surgery">${surgery.surgery}</div>
                            <div class="timeline-status">${surgery.status} - ${surgery.room}</div>
                        </div>
                    </div>
                `).join('');
            }

            renderDataTable() {
                const tableBody = document.getElementById('tableBody');
                if (!tableBody) {
                    console.error('tableBodyå…ƒç´ æœªæ‰¾åˆ°');
                    return;
                }
                
                if (!this.surgicalData || !this.surgicalData.departmentData) {
                    console.error('surgicalDataæˆ–departmentDataæœªæ‰¾åˆ°ï¼Œä½¿ç”¨é»˜è®¤æ•°æ®');
                    this.surgicalData = this.getDefaultSurgicalData();
                }
                
                const departments = this.surgicalData.departmentData;

                tableBody.innerHTML = departments.map(dept => `
                    <tr data-department="${dept.name}">
                        <td>${dept.name}</td>
                        <td>${dept.safetyCheckRate}%</td>
                        <td>${dept.levelManagementRate}%</td>
                        <td>${dept.preOpDiscussionRate}%</td>
                        <td>${dept.postOpSummaryRate}%</td>
                        <td>${dept.infectionPreventionRate}%</td>
                        <td><span class="status-badge ${dept.rating.toLowerCase()}">${dept.ratingText}</span></td>
                    </tr>
                `).join('');
            }

            initializeCharts() {
                this.charts.surgical = echarts.init(document.getElementById('surgicalChart'));
                this.updateChart('trend');
            }

            updateChart(type) {
                this.currentChartType = type;
                let option;

                switch (type) {
                    case 'trend':
                        option = this.getTrendChartOption();
                        break;
                    case 'risk':
                        option = this.getRiskChartOption();
                        break;
                    case 'comparison':
                        option = this.getComparisonChartOption();
                        break;
                }

                this.charts.surgical.setOption(option);
            }

            getTrendChartOption() {
                return {
                    title: {
                        text: 'æ‰‹æœ¯è´¨é‡å®‰å…¨æŒ‡æ ‡æœˆåº¦è¶‹åŠ¿',
                        left: 'center',
                        textStyle: { fontSize: 16, fontWeight: 'normal' }
                    },
                    tooltip: {
                        trigger: 'axis',
                        axisPointer: { type: 'cross' }
                    },
                    legend: {
                        data: ['æ‰‹æœ¯å®‰å…¨æ ¸æŸ¥ç‡', 'æ‰‹æœ¯åˆ†çº§ç®¡ç†ç‡', 'æœ¯å‰è®¨è®ºç‡', 'æ­»äº¡ç—…ä¾‹è®¨è®ºç‡'],
                        bottom: 10
                    },
                    grid: {
                        left: '3%',
                        right: '4%',
                        bottom: '15%',
                        containLabel: true
                    },
                    xAxis: {
                        type: 'category',
                        boundaryGap: false,
                        data: ['1æœˆ', '2æœˆ', '3æœˆ', '4æœˆ', '5æœˆ', '6æœˆ', '7æœˆ', '8æœˆ', '9æœˆ', '10æœˆ', '11æœˆ', '12æœˆ']
                    },
                    yAxis: {
                        type: 'value',
                        min: 85,
                        max: 100,
                        axisLabel: { formatter: '{value}%' }
                    },
                    series: [
                        {
                            name: 'æ‰‹æœ¯å®‰å…¨æ ¸æŸ¥ç‡',
                            type: 'line',
                            smooth: true,
                            data: [99.2, 99.3, 99.4, 99.5, 99.6, 99.7, 99.8, 99.7, 99.8, 99.8, 99.8, 99.8],
                            itemStyle: { color: '#28a745' }
                        },
                        {
                            name: 'æ‰‹æœ¯åˆ†çº§ç®¡ç†ç‡',
                            type: 'line',
                            smooth: true,
                            data: [96.2, 96.5, 96.8, 97.0, 97.2, 97.3, 97.5, 97.3, 97.4, 97.5, 97.5, 97.5],
                            itemStyle: { color: '#17a2b8' }
                        },
                        {
                            name: 'æœ¯å‰è®¨è®ºç‡',
                            type: 'line',
                            smooth: true,
                            data: [91.5, 91.8, 92.0, 92.3, 92.5, 92.8, 93.0, 92.8, 92.6, 92.3, 92.3, 92.3],
                            itemStyle: { color: '#ffc107' }
                        },
                        {
                            name: 'æ­»äº¡ç—…ä¾‹è®¨è®ºç‡',
                            type: 'line',
                            smooth: true,
                            data: [89.2, 89.5, 90.1, 90.8, 91.2, 91.0, 90.8, 90.5, 90.2, 88.9, 88.9, 88.9],
                            itemStyle: { color: '#dc3545' }
                        }
                    ]
                };
            }

            getRiskChartOption() {
                return {
                    title: {
                        text: 'æ‰‹æœ¯é£é™©åˆ†å¸ƒåˆ†æ',
                        left: 'center',
                        textStyle: { fontSize: 16, fontWeight: 'normal' }
                    },
                    tooltip: {
                        trigger: 'item',
                        formatter: '{a} <br/>{b}: {c} ({d}%)'
                    },
                    legend: {
                        orient: 'vertical',
                        left: 'left',
                        data: ['ä½é£é™©', 'ä¸­é£é™©', 'é«˜é£é™©', 'æé«˜é£é™©']
                    },
                    series: [
                        {
                            name: 'æ‰‹æœ¯é£é™©åˆ†å¸ƒ',
                            type: 'pie',
                            radius: '50%',
                            data: [
                                { value: 45, name: 'ä½é£é™©', itemStyle: { color: '#28a745' } },
                                { value: 23, name: 'ä¸­é£é™©', itemStyle: { color: '#ffc107' } },
                                { value: 8, name: 'é«˜é£é™©', itemStyle: { color: '#fd7e14' } },
                                { value: 2, name: 'æé«˜é£é™©', itemStyle: { color: '#dc3545' } }
                            ],
                            emphasis: {
                                itemStyle: {
                                    shadowBlur: 10,
                                    shadowOffsetX: 0,
                                    shadowColor: 'rgba(0, 0, 0, 0.5)'
                                }
                            }
                        }
                    ]
                };
            }

            getComparisonChartOption() {
                return {
                    title: {
                        text: 'å„ç§‘å®¤æ‰‹æœ¯è´¨é‡å¯¹æ¯”',
                        left: 'center',
                        textStyle: { fontSize: 16, fontWeight: 'normal' }
                    },
                    tooltip: {
                        trigger: 'axis',
                        axisPointer: { type: 'shadow' }
                    },
                    legend: {
                        data: ['å®‰å…¨æ ¸æŸ¥ç‡', 'åˆ†çº§ç®¡ç†ç‡', 'æœ¯å‰è®¨è®ºç‡'],
                        bottom: 10
                    },
                    grid: {
                        left: '3%',
                        right: '4%',
                        bottom: '15%',
                        containLabel: true
                    },
                    xAxis: {
                        type: 'category',
                        data: ['å¿ƒèƒ¸å¤–ç§‘', 'ç¥ç»å¤–ç§‘', 'éª¨ç§‘', 'æ™®é€šå¤–ç§‘', 'æ³Œå°¿å¤–ç§‘']
                    },
                    yAxis: {
                        type: 'value',
                        min: 85,
                        max: 100,
                        axisLabel: { formatter: '{value}%' }
                    },
                    series: [
                        {
                            name: 'å®‰å…¨æ ¸æŸ¥ç‡',
                            type: 'bar',
                            data: [100.0, 99.8, 99.5, 99.2, 99.7],
                            itemStyle: { color: '#28a745' }
                        },
                        {
                            name: 'åˆ†çº§ç®¡ç†ç‡',
                            type: 'bar',
                            data: [99.2, 98.7, 97.1, 96.5, 98.1],
                            itemStyle: { color: '#17a2b8' }
                        },
                        {
                            name: 'æœ¯å‰è®¨è®ºç‡',
                            type: 'bar',
                            data: [98.5, 96.2, 93.8, 91.3, 94.6],
                            itemStyle: { color: '#ffc107' }
                        }
                    ]
                };
            }

            bindEvents() {
                // å›¾è¡¨æ§åˆ¶æŒ‰é’®äº‹ä»¶
                document.querySelectorAll('.chart-control-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        document.querySelectorAll('.chart-control-btn').forEach(b => b.classList.remove('active'));
                        e.target.classList.add('active');
                        this.updateChart(e.target.dataset.type);
                    });
                });

                // ç»Ÿè®¡å¡ç‰‡ç‚¹å‡»äº‹ä»¶
                document.querySelectorAll('.stat-card').forEach(card => {
                    card.addEventListener('click', (e) => {
                        const metric = e.currentTarget.dataset.metric;
                        this.highlightMetric(metric);
                    });
                });

                // æŒ‡æ ‡é¡¹ç‚¹å‡»äº‹ä»¶
                document.querySelectorAll('.indicator-item').forEach(item => {
                    item.addEventListener('click', (e) => {
                        const indicator = e.currentTarget.dataset.indicator;
                        this.showIndicatorDetail(indicator);
                    });
                });

                // è¡¨æ ¼è¡Œç‚¹å‡»äº‹ä»¶
                document.querySelectorAll('#tableBody tr').forEach(row => {
                    row.addEventListener('click', (e) => {
                        document.querySelectorAll('#tableBody tr').forEach(r => r.classList.remove('selected'));
                        e.currentTarget.classList.add('selected');
                        const department = e.currentTarget.dataset.department;
                        this.showDepartmentDetail(department);
                    });
                });

                // æœç´¢å’Œç­›é€‰äº‹ä»¶
                document.getElementById('searchInput').addEventListener('input', (e) => {
                    this.filterTable(e.target.value);
                });

                document.getElementById('departmentFilter').addEventListener('change', (e) => {
                    this.filterByDepartment(e.target.value);
                });

                // çª—å£å¤§å°è°ƒæ•´äº‹ä»¶
                window.addEventListener('resize', () => {
                    Object.values(this.charts).forEach(chart => chart.resize());
                });
            }

            startRealTimeUpdates() {
                // æ¯30ç§’æ›´æ–°å®æ—¶æ•°æ®
                setInterval(() => {
                    this.updateRealTimeData();
                }, 30000);
            }

            updateRealTimeData() {
                this.realTimeData = this.dataSimulator.generateRealTimeSurgicalData();
                this.renderRealTimePanel();
            }

            getIndicatorStatus(current, target) {
                if (current >= target + 2) return 'excellent';
                if (current >= target) return 'good';
                if (current >= target - 2) return 'warning';
                return 'danger';
            }

            getTrendIcon(trend) {
                switch (trend) {
                    case 'up': return 'â†‘';
                    case 'down': return 'â†“';
                    case 'stable': return 'â†’';
                    default: return 'â†’';
                }
            }

            highlightMetric(metric) {
                console.log(`é«˜äº®æ˜¾ç¤ºæŒ‡æ ‡: ${metric}`);
                // åœ¨å›¾è¡¨ä¸­é«˜äº®æ˜¾ç¤ºç›¸å…³æ•°æ®
            }

            showIndicatorDetail(indicator) {
                console.log(`æ˜¾ç¤ºæŒ‡æ ‡è¯¦æƒ…: ${indicator}`);
                // æ˜¾ç¤ºæŒ‡æ ‡çš„è¯¦ç»†ä¿¡æ¯å’Œå†å²è¶‹åŠ¿
            }

            showDepartmentDetail(department) {
                console.log(`æ˜¾ç¤ºç§‘å®¤è¯¦æƒ…: ${department}`);
                // æ˜¾ç¤ºç§‘å®¤çš„è¯¦ç»†è´¨é‡æ•°æ®
            }

            filterTable(searchTerm) {
                const rows = document.querySelectorAll('#tableBody tr');
                rows.forEach(row => {
                    const text = row.textContent.toLowerCase();
                    row.style.display = text.includes(searchTerm.toLowerCase()) ? '' : 'none';
                });
            }

            filterByDepartment(department) {
                const rows = document.querySelectorAll('#tableBody tr');
                rows.forEach(row => {
                    if (department === 'all') {
                        row.style.display = '';
                    } else {
                        const deptName = row.cells[0].textContent;
                        const shouldShow = this.departmentMatches(deptName, department);
                        row.style.display = shouldShow ? '' : 'none';
                    }
                });
            }

            departmentMatches(deptName, filter) {
                const filterMap = {
                    'surgery': ['å¤–ç§‘', 'å¿ƒèƒ¸å¤–ç§‘', 'ç¥ç»å¤–ç§‘', 'æ™®é€šå¤–ç§‘', 'æ³Œå°¿å¤–ç§‘'],
                    'orthopedics': ['éª¨ç§‘'],
                    'neurosurgery': ['ç¥ç»å¤–ç§‘'],
                    'cardiac': ['å¿ƒèƒ¸å¤–ç§‘']
                };
                return filterMap[filter]?.some(dept => deptName.includes(dept)) || false;
            }
        }

        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            // ç­‰å¾…å¯¼èˆªç»„ä»¶åŠ è½½å®Œæˆ
            const checkNavigation = setInterval(() => {
                if (document.getElementById('navigation-container').innerHTML.trim() !== '') {
                    clearInterval(checkNavigation);
                    // åˆå§‹åŒ–æ‰‹æœ¯è´¨é‡å®‰å…¨ç›‘æµ‹é¡µé¢
                    new SurgicalQualityMonitor();
                }
            }, 100);
        });
    </script>
</body>
</html>