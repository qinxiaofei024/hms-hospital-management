<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æŠ¤ç†è´¨é‡ç›‘æµ‹ - åŒ»ç–—è´¨é‡å®‰å…¨ç›‘æµ‹ç³»ç»Ÿ</title>
    <link rel="stylesheet" href="../css/style.css">
    <link rel="stylesheet" href="../css/medical-quality-safety.css">
    <script src="../js/common.js"></script>
    <script src="../js/navigation-loader.js"></script>
    <script src="../js/medical-quality-components.js"></script>
    <script src="../js/medical-charts.js"></script>
    <script src="../js/medical-data-simulator.js"></script>
    
    <style>
        /* æŠ¤ç†è´¨é‡ç›‘æµ‹ä¸“ç”¨æ ·å¼ */
        .nursing-quality-container {
            padding: 20px;
            background: #f8f9fa;
            min-height: 100vh;
            max-width: 100%;
            overflow-x: hidden;
            box-sizing: border-box;
        }

        .page-header {
            background: linear-gradient(135deg, #e8f5e8 0%, #f0f8f0 100%);
            padding: 16px 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            margin-top: 10px;
            border-left: 5px solid #28a745;
        }

        .page-header h1 {
            color: #155724;
            font-size: 20px;
            margin: 0 0 8px 0;
            font-weight: 600;
        }

        .page-header .subtitle {
            color: #6c757d;
            font-size: 14px;
            margin: 0;
        }



        /* å®æ—¶ç›‘æ§é¢æ¿ */
        .real-time-panel {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 25px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            border-left: 4px solid #28a745;
        }

        .real-time-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .real-time-title {
            font-size: 18px;
            font-weight: 600;
            color: #155724;
            margin: 0;
        }

        .real-time-status {
            display: flex;
            align-items: center;
            gap: 8px;
            color: #28a745;
            font-size: 14px;
        }

        .status-indicator {
            width: 8px;
            height: 8px;
            background: #28a745;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }

        /* ç»Ÿè®¡å¡ç‰‡ç½‘æ ¼ */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 24px;
        }

        .stat-card {
            background: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
            cursor: pointer;
            border-left: 4px solid transparent;
        }

        .stat-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 15px rgba(0,0,0,0.15);
        }

        .stat-card.safety { border-left-color: #28a745; }
        .stat-card.quality { border-left-color: #17a2b8; }
        .stat-card.incident { border-left-color: #ffc107; }
        .stat-card.improvement { border-left-color: #dc3545; }

        .stat-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 15px;
        }

        .stat-title {
            font-size: 14px;
            color: #6c757d;
            font-weight: 500;
            line-height: 1.3;
        }

        .stat-icon {
            font-size: 24px;
            opacity: 0.8;
        }

        .stat-value {
            font-size: 28px;
            font-weight: 700;
            color: #2c3e50;
            margin-bottom: 8px;
        }

        .stat-change {
            font-size: 12px;
            font-weight: 500;
        }

        .stat-change.positive { color: #28a745; }
        .stat-change.negative { color: #dc3545; }
        .stat-change.stable { color: #6c757d; }

        /* ä¸»è¦å†…å®¹åŒºåŸŸå¸ƒå±€ */
        .main-content-area {
            margin-bottom: 24px;
            max-width: 100%;
            overflow-x: hidden;
        }

        .chart-and-indicators {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 20px;
            align-items: start;
            max-width: 100%;
            overflow-x: hidden;
        }

        .indicators-section {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .chart-container {
            background: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            max-width: 100%;
            overflow-x: hidden;
            min-width: 0;
        }

        .chart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f8f9fa;
        }

        .chart-title {
            font-size: 18px;
            font-weight: 600;
            color: #2c3e50;
            margin: 0;
        }

        .chart-controls {
            display: flex;
            gap: 8px;
        }

        .chart-control-btn {
            padding: 8px 16px;
            border: 1px solid #dee2e6;
            background: white;
            border-radius: 6px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .chart-control-btn:hover {
            background: #f8f9fa;
        }

        .chart-control-btn.active {
            background: #28a745;
            color: white;
            border-color: #28a745;
        }

        .chart-wrapper {
            height: 400px;
            width: 100%;
            max-width: 100%;
            overflow: hidden;
        }

        /* ä¾§è¾¹æ  */
        .sidebar {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .indicator-panel {
            background: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .indicator-header {
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f8f9fa;
        }

        .indicator-header h3 {
            font-size: 16px;
            font-weight: 600;
            color: #2c3e50;
            margin: 0 0 5px 0;
        }

        .indicator-header p {
            font-size: 14px;
            color: #6c757d;
            margin: 0;
        }

        .indicator-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .indicator-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            background: #f8f9fa;
            border-radius: 8px;
            transition: background 0.2s ease;
        }

        .indicator-item:hover {
            background: #e9ecef;
        }

        .indicator-name {
            font-size: 14px;
            color: #495057;
            font-weight: 500;
        }

        .indicator-value {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .indicator-number {
            font-weight: 600;
            font-size: 14px;
        }

        .indicator-number.excellent { color: #28a745; }
        .indicator-number.good { color: #17a2b8; }
        .indicator-number.warning { color: #ffc107; }
        .indicator-number.danger { color: #dc3545; }

        .indicator-trend {
            font-size: 12px;
            padding: 2px 6px;
            border-radius: 4px;
            font-weight: 500;
        }

        .indicator-trend.up {
            background: #d4edda;
            color: #155724;
        }

        .indicator-trend.down {
            background: #f8d7da;
            color: #721c24;
        }

        .indicator-trend.stable {
            background: #e2e3e5;
            color: #383d41;
        }

        /* æŠ¤ç†ç­æ¬¡åˆ†æ */
        .shift-analysis {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 25px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .shift-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-top: 15px;
        }

        .shift-card {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            text-align: center;
            border: 2px solid transparent;
            transition: all 0.3s ease;
        }

        .shift-card:hover {
            border-color: #28a745;
            background: #e8f5e8;
        }

        .shift-name {
            font-size: 14px;
            color: #6c757d;
            margin-bottom: 8px;
        }

        .shift-score {
            font-size: 20px;
            font-weight: 700;
            color: #2c3e50;
            margin-bottom: 5px;
        }

        .shift-status {
            font-size: 12px;
            padding: 3px 8px;
            border-radius: 4px;
            font-weight: 500;
        }

        /* æ•°æ®è¡¨æ ¼ */
        .data-table {
            background: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .table-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f8f9fa;
        }

        .table-header h3 {
            font-size: 18px;
            font-weight: 600;
            color: #2c3e50;
            margin: 0;
        }

        .table-controls {
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .search-box {
            position: relative;
        }

        .search-box input {
            padding: 8px 35px 8px 12px;
            border: 1px solid #dee2e6;
            border-radius: 6px;
            font-size: 0.9rem;
            width: 200px;
        }

        .search-icon {
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            color: #6c757d;
        }

        .filter-select {
            padding: 8px 12px;
            border: 1px solid #dee2e6;
            border-radius: 6px;
            font-size: 0.9rem;
            background: white;
        }

        .table-wrapper {
            overflow-x: auto;
        }

        .quality-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.9rem;
        }

        .quality-table th {
            background: #f8f9fa;
            padding: 12px;
            text-align: left;
            font-weight: 600;
            color: #495057;
            border-bottom: 2px solid #dee2e6;
        }

        .quality-table td {
            padding: 12px;
            border-bottom: 1px solid #dee2e6;
            color: #495057;
        }

        .quality-table tbody tr {
            transition: background 0.2s ease;
            cursor: pointer;
        }

        .quality-table tbody tr:hover {
            background: #f8f9fa;
        }

        .quality-table tbody tr.selected {
            background: #e8f5e8;
        }

        .status-badge {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 500;
        }

        .status-badge.excellent {
            background: #d4edda;
            color: #155724;
        }

        .status-badge.good {
            background: #d1ecf1;
            color: #0c5460;
        }

        .status-badge.warning {
            background: #fff3cd;
            color: #856404;
        }

        .status-badge.danger {
            background: #f8d7da;
            color: #721c24;
        }

        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 1200px) {
            .chart-and-indicators {
                grid-template-columns: 1fr;
                gap: 20px;
            }
            
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .nursing-quality-container {
                padding: 15px;
            }
            
            .chart-container {
                padding: 20px;
            }
        }

        @media (max-width: 768px) {
            .shift-grid {
                grid-template-columns: 1fr;
            }
            
            .table-controls {
                flex-direction: column;
                gap: 10px;
            }
            
            .search-box input {
                width: 100%;
            }
            
            .nursing-quality-container {
                padding: 10px;
            }
            
            .chart-container {
                padding: 15px;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
                gap: 15px;
            }
            
            .chart-wrapper {
                height: 300px;
            }
        }

        @media (max-width: 480px) {
            .nursing-quality-container {
                padding: 8px;
            }
            
            .chart-container {
                padding: 12px;
            }
            
            .page-header h1 {
                font-size: 18px;
            }
            
            .chart-wrapper {
                height: 250px;
            }
        }
    </style>
</head>
<body>
    <!-- ç»Ÿä¸€å¯¼èˆªç»„ä»¶ -->
    <div id="navigation-container"></div>
    
    <div class="container">
        <div class="main-content">
            <div class="content-wrapper">
                <main class="content">
                    <div class="nursing-quality-container">
                        <!-- é¡µé¢æ ‡é¢˜ -->
                        <div class="page-header">
                            <h1>æŠ¤ç†è´¨é‡ç›‘æµ‹</h1>
                            <div class="subtitle">Nursing Quality Monitoring - ä¸“ä¸šæŠ¤ç†è´¨é‡å®‰å…¨ç›‘æ§å¹³å°</div>
                        </div>



                        <!-- å®æ—¶ç›‘æ§é¢æ¿ -->
                        <div class="real-time-panel">
                            <div class="real-time-header">
                                <h3 class="real-time-title">æŠ¤ç†è´¨é‡å®æ—¶ç›‘æ§</h3>
                                <div class="real-time-status">
                                    <div class="status-indicator"></div>
                                    <span>å®æ—¶æ›´æ–°ä¸­</span>
                                </div>
                            </div>
                            <div id="realTimeData"></div>
                        </div>

                        <!-- ç»Ÿè®¡å¡ç‰‡åŒºåŸŸ -->
                        <div class="stats-grid" id="statsGrid"></div>

                        <!-- ä¸»è¦å†…å®¹åŒºåŸŸ -->
                        <div class="main-content-area">
                            <!-- å›¾è¡¨å’ŒæŒ‡æ ‡åŒºåŸŸ -->
                            <div class="chart-and-indicators">
                                <!-- å›¾è¡¨åŒºåŸŸ -->
                                <div class="chart-container">
                                    <div class="chart-header">
                                        <h3 class="chart-title">æŠ¤ç†è´¨é‡è¶‹åŠ¿åˆ†æ</h3>
                                        <div class="chart-controls">
                                            <button class="chart-control-btn active" data-type="trend">è¶‹åŠ¿åˆ†æ</button>
                                            <button class="chart-control-btn" data-type="radar">é›·è¾¾å›¾</button>
                                            <button class="chart-control-btn" data-type="comparison">ç§‘å®¤å¯¹æ¯”</button>
                                        </div>
                                    </div>
                                    <div class="chart-wrapper">
                                        <div id="nursingChart" style="width: 100%; height: 100%;"></div>
                                    </div>
                                </div>

                                <!-- æŠ¤ç†è´¨é‡æŒ‡æ ‡å’Œé¢„è­¦åŒºåŸŸ -->
                                <div class="indicators-section">
                                    <!-- æŠ¤ç†è´¨é‡æŒ‡æ ‡ -->
                                    <div class="indicator-panel">
                                        <div class="indicator-header">
                                            <h3>æŠ¤ç†è´¨é‡æŒ‡æ ‡</h3>
                                            <p>å®æ—¶ç›‘æ§æŠ¤ç†è´¨é‡å…³é”®æŒ‡æ ‡</p>
                                        </div>
                                        <div class="indicator-list" id="qualityIndicators"></div>
                                    </div>

                                    <!-- æŠ¤ç†å®‰å…¨é¢„è­¦ -->
                                    <div class="indicator-panel">
                                        <div class="indicator-header">
                                            <h3>æŠ¤ç†å®‰å…¨é¢„è­¦</h3>
                                            <p>éœ€è¦å…³æ³¨çš„æŠ¤ç†å®‰å…¨äº‹ä»¶</p>
                                        </div>
                                        <div class="indicator-list" id="safetyAlerts"></div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- æŠ¤ç†ç­æ¬¡åˆ†æ -->
                        <div class="shift-analysis">
                            <div class="indicator-header">
                                <h3>æŠ¤ç†ç­æ¬¡è´¨é‡åˆ†æ</h3>
                                <p>å„ç­æ¬¡æŠ¤ç†è´¨é‡è¡¨ç°å¯¹æ¯”</p>
                            </div>
                            <div class="shift-grid" id="shiftAnalysis"></div>
                        </div>

                        <!-- è¯¦ç»†æ•°æ®è¡¨æ ¼ -->
                        <div class="data-table">
                            <div class="table-header">
                                <h3>æŠ¤ç†å•å…ƒè´¨é‡æ‰§è¡Œæƒ…å†µè¯¦è¡¨</h3>
                                <div class="table-controls">
                                    <div class="search-box">
                                        <input type="text" placeholder="æœç´¢æŠ¤ç†å•å…ƒ..." id="searchInput">
                                        <span class="search-icon">ğŸ”</span>
                                    </div>
                                    <select class="filter-select" id="departmentFilter">
                                        <option value="all">å…¨éƒ¨ç§‘å®¤</option>
                                        <option value="icu">é‡ç—‡ç›‘æŠ¤</option>
                                        <option value="internal">å†…ç§‘ç—…åŒº</option>
                                        <option value="surgery">å¤–ç§‘ç—…åŒº</option>
                                        <option value="emergency">æ€¥è¯Šç§‘</option>
                                        <option value="obstetrics">å¦‡äº§ç§‘</option>
                                    </select>
                                </div>
                            </div>
                            <div class="table-wrapper">
                                <table class="quality-table" id="qualityTable">
                                    <thead>
                                        <tr>
                                            <th>æŠ¤ç†å•å…ƒ</th>
                                            <th>æŠ¤ç†å®‰å…¨è¯„åˆ†</th>
                                            <th>æ‚£è€…æ»¡æ„åº¦</th>
                                            <th>æŠ¤ç†æ–‡ä¹¦åˆæ ¼ç‡</th>
                                            <th>ä¸è‰¯äº‹ä»¶ç‡</th>
                                            <th>æŠ¤ç†å·¥ä½œé‡</th>
                                            <th>ç»¼åˆè¯„çº§</th>
                                        </tr>
                                    </thead>
                                    <tbody id="tableBody"></tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </main>
            </div>
        </div>
    </div>

    <script>
        // æŠ¤ç†è´¨é‡ç›‘æµ‹ç®¡ç†ç±»
        class NursingQualityMonitor {
            constructor() {
                this.dataSimulator = new MedicalDataSimulator();
                this.charts = {};
                this.currentData = null;
                this.init();
            }

            async init() {
                try {
                    console.log('å¼€å§‹åˆå§‹åŒ–æŠ¤ç†è´¨é‡ç›‘æµ‹é¡µé¢...');
                    
                    // ç¡®ä¿EChartså·²åŠ è½½
                    await Common.ensureEcharts();
                    
                    // ç­‰å¾…å¯¼èˆªåŠ è½½å®Œæˆ
                    await this.waitForNavigation();
                    
                    // åˆå§‹åŒ–æ•°æ®æ¨¡æ‹Ÿå™¨
                    this.dataSimulator.initializeBaseData();
                    
                    // ç”ŸæˆæŠ¤ç†è´¨é‡æ•°æ®
                    this.generateNursingData();
                    
                    // åˆå§‹åŒ–å„ä¸ªç»„ä»¶
                    this.initRealTimePanel();
                    this.initStatsCards();
                    this.initCharts();
                    this.initIndicators();
                    this.initShiftAnalysis();
                    this.initDataTable();
                    this.initEventListeners();
                    
                    console.log('æŠ¤ç†è´¨é‡ç›‘æµ‹ç³»ç»Ÿåˆå§‹åŒ–å®Œæˆ');
                } catch (error) {
                    console.error('æŠ¤ç†è´¨é‡ç›‘æµ‹ç³»ç»Ÿåˆå§‹åŒ–å¤±è´¥:', error);
                }
            }

            waitForNavigation() {
                return new Promise((resolve) => {
                    if (document.getElementById('navigation-container').innerHTML) {
                        resolve();
                    } else {
                        const observer = new MutationObserver((mutations) => {
                            mutations.forEach((mutation) => {
                                if (mutation.addedNodes.length > 0) {
                                    observer.disconnect();
                                    resolve();
                                }
                            });
                        });
                        observer.observe(document.getElementById('navigation-container'), {
                            childList: true,
                            subtree: true
                        });
                    }
                });
            }

            generateNursingData() {
                // ç”ŸæˆæŠ¤ç†è´¨é‡ç›¸å…³æ•°æ®
                this.currentData = {
                    realTime: this.generateRealTimeData(),
                    stats: this.generateStatsData(),
                    trends: this.generateTrendData(),
                    indicators: this.generateIndicatorData(),
                    shifts: this.generateShiftData(),
                    departments: this.generateDepartmentData()
                };
            }

            generateRealTimeData() {
                return {
                    activeNurses: Math.floor(Math.random() * 50) + 180,
                    patientsUnderCare: Math.floor(Math.random() * 100) + 320,
                    criticalAlerts: Math.floor(Math.random() * 5) + 2,
                    qualityScore: (Math.random() * 5 + 93).toFixed(1)
                };
            }

            generateStatsData() {
                return [
                    {
                        title: 'æŠ¤ç†å®‰å…¨è¯„åˆ†',
                        value: (Math.random() * 3 + 96).toFixed(1) + 'åˆ†',
                        change: (Math.random() * 2 + 0.5).toFixed(1),
                        trend: 'positive',
                        type: 'safety',
                        icon: 'ğŸ›¡ï¸'
                    },
                    {
                        title: 'æ‚£è€…æ»¡æ„åº¦',
                        value: (Math.random() * 4 + 94).toFixed(1) + '%',
                        change: (Math.random() * 3 + 1).toFixed(1),
                        trend: 'positive',
                        type: 'quality',
                        icon: 'ğŸ˜Š'
                    },
                    {
                        title: 'æŠ¤ç†æ–‡ä¹¦åˆæ ¼ç‡',
                        value: (Math.random() * 3 + 96).toFixed(1) + '%',
                        change: (Math.random() * 2 + 0.8).toFixed(1),
                        trend: 'positive',
                        type: 'quality',
                        icon: 'ğŸ“‹'
                    },
                    {
                        title: 'ä¸è‰¯äº‹ä»¶å‘ç”Ÿç‡',
                        value: (Math.random() * 0.3 + 0.1).toFixed(2) + '%',
                        change: (Math.random() * 0.1 + 0.05).toFixed(2),
                        trend: 'negative',
                        type: 'incident',
                        icon: 'âš ï¸'
                    }
                ];
            }

            generateTrendData() {
                const months = ['1æœˆ', '2æœˆ', '3æœˆ', '4æœˆ', '5æœˆ', '6æœˆ', '7æœˆ', '8æœˆ', '9æœˆ', '10æœˆ', '11æœˆ', '12æœˆ'];
                return {
                    months,
                    nursingScore: months.map(() => Math.random() * 5 + 93),
                    satisfaction: months.map(() => Math.random() * 6 + 92),
                    documentation: months.map(() => Math.random() * 4 + 95),
                    incidents: months.map(() => Math.random() * 0.4 + 0.1)
                };
            }

            generateIndicatorData() {
                return [
                    { name: 'æŠ¤ç†æ ¸å¿ƒåˆ¶åº¦æ‰§è¡Œç‡', value: 98.7, status: 'excellent', trend: 'up' },
                    { name: 'æŠ¤ç†å®‰å…¨ç®¡ç†æ‰§è¡Œç‡', value: 97.2, status: 'excellent', trend: 'up' },
                    { name: 'æŠ¤ç†æ–‡ä¹¦ä¹¦å†™åˆæ ¼ç‡', value: 96.8, status: 'good', trend: 'stable' },
                    { name: 'æ‚£è€…è·Œå€’å‘ç”Ÿç‡', value: 0.08, status: 'good', trend: 'down', reverse: true },
                    { name: 'å‹ç–®å‘ç”Ÿç‡', value: 0.05, status: 'excellent', trend: 'down', reverse: true },
                    { name: 'ç”¨è¯é”™è¯¯ç‡', value: 0.02, status: 'excellent', trend: 'down', reverse: true }
                ];
            }

            generateShiftData() {
                return [
                    { name: 'ç™½ç­', score: (Math.random() * 5 + 93).toFixed(1), status: 'excellent' },
                    { name: 'å¤œç­', score: (Math.random() * 5 + 91).toFixed(1), status: 'good' },
                    { name: 'ä¸­ç­', score: (Math.random() * 5 + 92).toFixed(1), status: 'good' }
                ];
            }

            generateDepartmentData() {
                const departments = [
                    'ICU', 'å¿ƒè¡€ç®¡å†…ç§‘', 'ç¥ç»å¤–ç§‘', 'æ€¥è¯Šç§‘', 'éª¨ç§‘ç—…åŒº',
                    'å¦‡äº§ç§‘', 'å„¿ç§‘ç—…åŒº', 'å‘¼å¸å†…ç§‘', 'æ¶ˆåŒ–å†…ç§‘', 'æ³Œå°¿å¤–ç§‘'
                ];
                
                return departments.map(dept => ({
                    name: dept,
                    safetyScore: (Math.random() * 8 + 90).toFixed(1),
                    satisfaction: (Math.random() * 8 + 90).toFixed(1),
                    documentation: (Math.random() * 6 + 92).toFixed(1),
                    incidentRate: (Math.random() * 0.5 + 0.1).toFixed(2),
                    workload: Math.floor(Math.random() * 30 + 70),
                    rating: this.getQualityRating(Math.random() * 20 + 80)
                }));
            }

            getQualityRating(score) {
                if (score >= 95) return { text: 'ä¼˜ç§€', class: 'excellent' };
                if (score >= 85) return { text: 'è‰¯å¥½', class: 'good' };
                if (score >= 75) return { text: 'åˆæ ¼', class: 'warning' };
                return { text: 'éœ€æ”¹è¿›', class: 'danger' };
            }

            initRealTimePanel() {
                const container = document.getElementById('realTimeData');
                const data = this.currentData.realTime;
                
                container.innerHTML = `
                    <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 20px;">
                        <div style="text-align: center; padding: 15px; background: #f8f9fa; border-radius: 8px;">
                            <div style="font-size: 24px; font-weight: 700; color: #28a745;">${data.activeNurses}</div>
                            <div style="font-size: 14px; color: #6c757d;">åœ¨å²—æŠ¤å£«</div>
                        </div>
                        <div style="text-align: center; padding: 15px; background: #f8f9fa; border-radius: 8px;">
                            <div style="font-size: 24px; font-weight: 700; color: #17a2b8;">${data.patientsUnderCare}</div>
                            <div style="font-size: 14px; color: #6c757d;">åœ¨æŠ¤æ‚£è€…</div>
                        </div>
                        <div style="text-align: center; padding: 15px; background: #f8f9fa; border-radius: 8px;">
                            <div style="font-size: 24px; font-weight: 700; color: #ffc107;">${data.criticalAlerts}</div>
                            <div style="font-size: 14px; color: #6c757d;">ç´§æ€¥é¢„è­¦</div>
                        </div>
                        <div style="text-align: center; padding: 15px; background: #f8f9fa; border-radius: 8px;">
                            <div style="font-size: 24px; font-weight: 700; color: #28a745;">${data.qualityScore}</div>
                            <div style="font-size: 14px; color: #6c757d;">è´¨é‡è¯„åˆ†</div>
                        </div>
                    </div>
                `;
            }

            initStatsCards() {
                const container = document.getElementById('statsGrid');
                const stats = this.currentData.stats;
                
                container.innerHTML = stats.map(stat => `
                    <div class="stat-card ${stat.type}" data-title="${stat.title}">
                        <div class="stat-header">
                            <div class="stat-title">${stat.title}</div>
                            <div class="stat-icon">${stat.icon}</div>
                        </div>
                        <div class="stat-value">${stat.value}</div>
                        <div class="stat-change ${stat.trend}">
                            ${stat.trend === 'positive' ? 'â†‘' : 'â†“'} ${stat.change}% è¾ƒä¸Šæœˆ
                        </div>
                    </div>
                `).join('');
            }

            initCharts() {
                this.initTrendChart();
            }

            initTrendChart() {
                const chartDom = document.getElementById('nursingChart');
                const chart = echarts.init(chartDom);
                this.charts.trend = chart;

                const data = this.currentData.trends;
                const option = {
                    title: {
                        text: 'æŠ¤ç†è´¨é‡æŒ‡æ ‡æœˆåº¦è¶‹åŠ¿',
                        left: 'center',
                        textStyle: {
                            fontSize: 16,
                            fontWeight: 'normal'
                        }
                    },
                    tooltip: {
                        trigger: 'axis',
                        axisPointer: {
                            type: 'cross'
                        }
                    },
                    legend: {
                        data: ['æŠ¤ç†å®‰å…¨è¯„åˆ†', 'æ‚£è€…æ»¡æ„åº¦', 'æŠ¤ç†æ–‡ä¹¦åˆæ ¼ç‡', 'ä¸è‰¯äº‹ä»¶ç‡'],
                        bottom: 10
                    },
                    grid: {
                        left: '3%',
                        right: '4%',
                        bottom: '15%',
                        containLabel: true
                    },
                    xAxis: {
                        type: 'category',
                        boundaryGap: false,
                        data: data.months
                    },
                    yAxis: [
                        {
                            type: 'value',
                            name: 'è¯„åˆ†/æ»¡æ„åº¦(%)',
                            min: 85,
                            max: 100,
                            axisLabel: {
                                formatter: '{value}'
                            }
                        },
                        {
                            type: 'value',
                            name: 'ä¸è‰¯äº‹ä»¶ç‡(%)',
                            min: 0,
                            max: 1,
                            axisLabel: {
                                formatter: '{value}%'
                            }
                        }
                    ],
                    series: [
                        {
                            name: 'æŠ¤ç†å®‰å…¨è¯„åˆ†',
                            type: 'line',
                            smooth: true,
                            data: data.nursingScore,
                            itemStyle: { color: '#28a745' }
                        },
                        {
                            name: 'æ‚£è€…æ»¡æ„åº¦',
                            type: 'line',
                            smooth: true,
                            data: data.satisfaction,
                            itemStyle: { color: '#17a2b8' }
                        },
                        {
                            name: 'æŠ¤ç†æ–‡ä¹¦åˆæ ¼ç‡',
                            type: 'line',
                            smooth: true,
                            data: data.documentation,
                            itemStyle: { color: '#6f42c1' }
                        },
                        {
                            name: 'ä¸è‰¯äº‹ä»¶ç‡',
                            type: 'line',
                            smooth: true,
                            yAxisIndex: 1,
                            data: data.incidents,
                            itemStyle: { color: '#dc3545' }
                        }
                    ]
                };

                chart.setOption(option);
                
                // å“åº”å¼å¤„ç†
                window.addEventListener('resize', () => {
                    chart.resize();
                });
            }

            initIndicators() {
                const container = document.getElementById('qualityIndicators');
                const indicators = this.currentData.indicators;
                
                container.innerHTML = indicators.map(indicator => `
                    <div class="indicator-item">
                        <div class="indicator-name">${indicator.name}</div>
                        <div class="indicator-value">
                            <span class="indicator-number ${indicator.status}">
                                ${indicator.reverse ? indicator.value + '%' : indicator.value + (indicator.name.includes('ç‡') ? '%' : 'åˆ†')}
                            </span>
                            <span class="indicator-trend ${indicator.trend}">
                                ${indicator.trend === 'up' ? 'â†‘' : indicator.trend === 'down' ? 'â†“' : 'â†’'}
                            </span>
                        </div>
                    </div>
                `).join('');

                // åˆå§‹åŒ–å®‰å…¨é¢„è­¦
                const alertsContainer = document.getElementById('safetyAlerts');
                const alerts = [
                    { message: 'ICUç—…åŒºæŠ¤ç†å·¥ä½œé‡åé«˜', level: 'warning' },
                    { message: 'æ€¥è¯Šç§‘å¤œç­æŠ¤ç†äººå‘˜ä¸è¶³', level: 'danger' },
                    { message: 'éª¨ç§‘ç—…åŒºè·Œå€’é£é™©å¢åŠ ', level: 'warning' }
                ];
                
                alertsContainer.innerHTML = alerts.map(alert => `
                    <div class="indicator-item">
                        <div class="indicator-name">${alert.message}</div>
                        <div class="indicator-value">
                            <span class="indicator-trend ${alert.level === 'danger' ? 'down' : 'stable'}">
                                ${alert.level === 'danger' ? 'ç´§æ€¥' : 'å…³æ³¨'}
                            </span>
                        </div>
                    </div>
                `).join('');
            }

            initShiftAnalysis() {
                const container = document.getElementById('shiftAnalysis');
                const shifts = this.currentData.shifts;
                
                container.innerHTML = shifts.map(shift => `
                    <div class="shift-card">
                        <div class="shift-name">${shift.name}</div>
                        <div class="shift-score">${shift.score}</div>
                        <div class="shift-status ${shift.status}">${shift.status === 'excellent' ? 'ä¼˜ç§€' : 'è‰¯å¥½'}</div>
                    </div>
                `).join('');
            }

            initDataTable() {
                const tbody = document.getElementById('tableBody');
                const departments = this.currentData.departments;
                
                tbody.innerHTML = departments.map(dept => `
                    <tr data-department="${dept.name}">
                        <td>${dept.name}</td>
                        <td>${dept.safetyScore}åˆ†</td>
                        <td>${dept.satisfaction}%</td>
                        <td>${dept.documentation}%</td>
                        <td>${dept.incidentRate}%</td>
                        <td>${dept.workload}%</td>
                        <td><span class="status-badge ${dept.rating.class}">${dept.rating.text}</span></td>
                    </tr>
                `).join('');
            }

            initEventListeners() {
                // ç»Ÿè®¡å¡ç‰‡ç‚¹å‡»äº‹ä»¶
                document.querySelectorAll('.stat-card').forEach(card => {
                    card.addEventListener('click', () => {
                        const title = card.dataset.title;
                        console.log(`ç‚¹å‡»ç»Ÿè®¡å¡ç‰‡: ${title}`);
                        this.highlightRelatedData(title);
                    });
                });

                // å›¾è¡¨æ§åˆ¶æŒ‰é’®
                document.querySelectorAll('.chart-control-btn').forEach(btn => {
                    btn.addEventListener('click', () => {
                        document.querySelectorAll('.chart-control-btn').forEach(b => b.classList.remove('active'));
                        btn.classList.add('active');
                        
                        const type = btn.dataset.type;
                        this.switchChartType(type);
                    });
                });

                // è¡¨æ ¼è¡Œç‚¹å‡»äº‹ä»¶
                document.querySelectorAll('#tableBody tr').forEach(row => {
                    row.addEventListener('click', () => {
                        document.querySelectorAll('#tableBody tr').forEach(r => r.classList.remove('selected'));
                        row.classList.add('selected');
                        
                        const department = row.dataset.department;
                        console.log(`é€‰ä¸­æŠ¤ç†å•å…ƒ: ${department}`);
                    });
                });

                // æœç´¢åŠŸèƒ½
                const searchInput = document.getElementById('searchInput');
                searchInput.addEventListener('input', (e) => {
                    this.filterTable(e.target.value);
                });

                // ç§‘å®¤ç­›é€‰
                const departmentFilter = document.getElementById('departmentFilter');
                departmentFilter.addEventListener('change', (e) => {
                    this.filterByDepartment(e.target.value);
                });
            }

            highlightRelatedData(title) {
                // æ ¹æ®ç‚¹å‡»çš„ç»Ÿè®¡å¡ç‰‡é«˜äº®ç›¸å…³æ•°æ®
                console.log(`é«˜äº®æ˜¾ç¤ºä¸ ${title} ç›¸å…³çš„æ•°æ®`);
            }

            switchChartType(type) {
                const chart = this.charts.trend;
                if (!chart) return;

                switch (type) {
                    case 'radar':
                        this.showRadarChart();
                        break;
                    case 'comparison':
                        this.showComparisonChart();
                        break;
                    default:
                        this.initTrendChart();
                        break;
                }
            }

            showRadarChart() {
                const chart = this.charts.trend;
                const option = {
                    title: {
                        text: 'æŠ¤ç†è´¨é‡å¤šç»´åº¦è¯„ä¼°',
                        left: 'center'
                    },
                    tooltip: {},
                    radar: {
                        indicator: [
                            { name: 'æ‚£è€…å®‰å…¨', max: 100 },
                            { name: 'ç”¨è¯å®‰å…¨', max: 100 },
                            { name: 'æ„ŸæŸ“æ§åˆ¶', max: 100 },
                            { name: 'æ‚£è€…æ»¡æ„åº¦', max: 100 },
                            { name: 'æŠ¤ç†æ–‡ä¹¦', max: 100 },
                            { name: 'ä¸“ä¸šå‘å±•', max: 100 }
                        ]
                    },
                    series: [{
                        name: 'æŠ¤ç†è´¨é‡è¯„ä¼°',
                        type: 'radar',
                        data: [
                            {
                                value: [96, 94, 98, 95, 97, 92],
                                name: 'å½“å‰æ°´å¹³'
                            },
                            {
                                value: [95, 95, 95, 95, 95, 95],
                                name: 'ç›®æ ‡æ°´å¹³'
                            }
                        ]
                    }]
                };
                chart.setOption(option);
            }

            showComparisonChart() {
                const chart = this.charts.trend;
                const departments = this.currentData.departments.slice(0, 6);
                
                const option = {
                    title: {
                        text: 'æŠ¤ç†å•å…ƒè´¨é‡å¯¹æ¯”',
                        left: 'center'
                    },
                    tooltip: {
                        trigger: 'axis',
                        axisPointer: {
                            type: 'shadow'
                        }
                    },
                    legend: {
                        data: ['æŠ¤ç†å®‰å…¨è¯„åˆ†', 'æ‚£è€…æ»¡æ„åº¦'],
                        bottom: 10
                    },
                    xAxis: {
                        type: 'category',
                        data: departments.map(d => d.name)
                    },
                    yAxis: {
                        type: 'value',
                        min: 85,
                        max: 100
                    },
                    series: [
                        {
                            name: 'æŠ¤ç†å®‰å…¨è¯„åˆ†',
                            type: 'bar',
                            data: departments.map(d => parseFloat(d.safetyScore)),
                            itemStyle: { color: '#28a745' }
                        },
                        {
                            name: 'æ‚£è€…æ»¡æ„åº¦',
                            type: 'bar',
                            data: departments.map(d => parseFloat(d.satisfaction)),
                            itemStyle: { color: '#17a2b8' }
                        }
                    ]
                };
                chart.setOption(option);
            }

            filterTable(searchTerm) {
                const rows = document.querySelectorAll('#tableBody tr');
                rows.forEach(row => {
                    const text = row.textContent.toLowerCase();
                    const visible = text.includes(searchTerm.toLowerCase());
                    row.style.display = visible ? '' : 'none';
                });
            }

            filterByDepartment(department) {
                const rows = document.querySelectorAll('#tableBody tr');
                rows.forEach(row => {
                    if (department === 'all') {
                        row.style.display = '';
                    } else {
                        const deptName = row.dataset.department;
                        const visible = this.matchesDepartmentFilter(deptName, department);
                        row.style.display = visible ? '' : 'none';
                    }
                });
            }

            matchesDepartmentFilter(deptName, filter) {
                const filterMap = {
                    'icu': ['ICU'],
                    'internal': ['å†…ç§‘', 'å¿ƒè¡€ç®¡å†…ç§‘', 'å‘¼å¸å†…ç§‘', 'æ¶ˆåŒ–å†…ç§‘'],
                    'surgery': ['å¤–ç§‘', 'ç¥ç»å¤–ç§‘', 'éª¨ç§‘', 'æ³Œå°¿å¤–ç§‘'],
                    'emergency': ['æ€¥è¯Šç§‘'],
                    'obstetrics': ['å¦‡äº§ç§‘', 'å„¿ç§‘']
                };
                
                const keywords = filterMap[filter] || [];
                return keywords.some(keyword => deptName.includes(keyword));
            }
        }

        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', () => {
            new NursingQualityMonitor();
        });
    </script>
</body>
</html>